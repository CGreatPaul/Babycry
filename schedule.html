<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考研复习时间表 | 增强版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 40px 20px;
            color: white;
            margin-bottom: 30px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.8;
        }
        
        .principles {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 30px 0;
            justify-content: center;
        }
        
        .principle-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            padding: 20px;
            width: 280px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        .principle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .principle-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #1a2980;
        }
        
        .schedule-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }
        
        .timeline {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .timeline-header {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        .timeline-items {
            padding: 25px 20px;
        }
        
        .timeline-item {
            display: flex;
            padding: 20px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }
        
        .timeline-item:hover {
            background-color: #f9f9ff;
            transform: scale(1.01);
        }
        
        .timeline-item:last-child {
            border-bottom: none;
        }
        
        .time {
            font-weight: bold;
            min-width: 130px;
            color: #1a2980;
            font-size: 1.1rem;
        }
        
        .activity {
            flex-grow: 1;
            padding: 0 20px;
        }
        
        .activity-title {
            font-weight: 600;
            font-size: 1.15rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        .duration {
            background: #eef7ff;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #1a2980;
            font-weight: 500;
            display: inline-block;
            margin-left: 10px;
        }
        
        .subject {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 500;
            font-size: 0.85rem;
            margin-top: 8px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        
        .math { background: linear-gradient(to right, #ff416c, #ff4b2b); }
        .english { background: linear-gradient(to right, #2193b0, #6dd5ed); }
        .major { background: linear-gradient(to right, #38ef7d, #11998e); }
        .politics { background: linear-gradient(to right, #8e2de2, #4a00e0); }
        .rest { background: linear-gradient(to right, #ff9a9e, #fad0c4); color: #333; }
        .meal { background: linear-gradient(to right, #ff9a9e, #fecfef); color: #333; }
        .review { background: linear-gradient(to right, #00c6ff, #0072ff); color: white; }
        
        .notes {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        .notes h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            text-align: center;
        }
        
        .tips {
            margin-top: 30px;
        }
        
        .tip {
            background: #f8fbff;
            padding: 20px;
            border-left: 4px solid #26d0ce;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s;
        }
        
        .tip:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .tip h3 {
            color: #1a2980;
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        
        .tip h3 i {
            margin-right: 10px;
            color: #ff4b2b;
        }
        
        .motivation {
            text-align: center;
            background: linear-gradient(to right, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 15px;
            padding: 40px 30px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .motivation i {
            font-size: 3.5rem;
            color: #ff4b2b;
            margin-bottom: 25px;
        }
        
        .quote {
            font-style: italic;
            font-size: 1.6rem;
            color: #1a2980;
            margin: 25px 0;
            line-height: 1.8;
            font-weight: 500;
        }
        
        .author {
            font-weight: bold;
            color: #4a00e0;
            font-size: 1.1rem;
        }
        
        footer {
            text-align: center;
            color: white;
            padding: 25px;
            margin-top: 20px;
            opacity: 0.9;
            font-size: 1.1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        .highlight {
            background: linear-gradient(120deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1));
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .tomato {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #ff4b2b;
            border-radius: 50%;
            margin-right: 8px;
            position: relative;
            top: 2px;
        }
        
        .english-highlight {
            animation: pulse-english 2s infinite;
            position: relative;
        }
        
        .update-badge {
            background: #FFD700;
            color: #8B4513;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            display: inline-block;
        }
        
        .task-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .btn-start {
            background-color: #26d0ce;
            color: white;
        }
        
        .btn-start:hover {
            background-color: #1aa09e;
        }
        
        .btn-complete {
            background-color: #eef7ff;
            color: #1a2980;
        }
        
        .btn-complete:hover {
            background-color: #d9eafd;
        }
        
        .btn-pause {
            background-color: #ffc107;
            color: white;
        }
        
        .btn-pause:hover {
            background-color: #e0a800;
        }
        
        .btn-resume {
            background-color: #28a745;
            color: white;
        }
        
        .btn-resume:hover {
            background-color: #218838;
        }
        
        .timer {
            font-size: 1.1rem;
            margin-top: 10px;
            color: #1a2980;
            font-weight: bold;
            min-height: 24px;
        }
        
        .completed .activity-title,
        .completed p {
            text-decoration: line-through;
            color: #a0a0a0;
        }
        
        .completed .btn-complete {
            background-color: #28a745;
            color: white;
        }
        
        .active-task {
            background-color: #f0f7ff !important;
            border-left: 4px solid #26d0ce;
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .timer-running {
            animation: pulse 1.5s infinite;
        }
        
        .timer-completed {
            color: #28a745;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes pulse-english {
            0% { box-shadow: 0 0 0 0 rgba(33, 147, 176, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(33, 147, 176, 0); }
            100% { box-shadow: 0 0 0 0 rgba(33, 147, 176, 0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 75, 43, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 75, 43, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 75, 43, 0); }
        }
        
        @media (max-width: 768px) {
            .schedule-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .principle-card {
                width: 100%;
            }
            
            .quote {
                font-size: 1.3rem;
            }
            
            .timeline-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time {
                margin-bottom: 10px;
            }
            
            .activity {
                padding: 0;
            }
            
            .task-controls {
                margin-top: 15px;
            }
        }
        #calendar-module-wrapper {
            display: flex;
            justify-content: center;
            margin: 30px auto 20px auto;
        }
        #calendar-view {
            background: rgba(255,255,255,0.95);
            border-radius: 22px;
            box-shadow: 0 8px 32px rgba(26,41,128,0.13);
            padding: 32px 32px 24px 32px;
            min-width: 370px;
            max-width: 440px;
            margin: 0 auto;
            border: 1.5px solid #e0e7ef;
        }
        #calendar-view .calendar-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.7rem;
            margin-bottom: 16px;
            color: #1a2980;
            letter-spacing: 1px;
        }
        #calendar-view .calendar-header-btn {
            margin: 0 18px;
            padding: 6px 18px;
            border-radius: 10px;
            border: 1.5px solid #b5c6e0;
            background: #f7fafc;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            color: #1a2980;
            box-shadow: 0 2px 8px rgba(26,41,128,0.07);
            transition: background 0.2s, color 0.2s;
        }
        #calendar-view .calendar-header-btn:hover {
            background: #e0e7ef;
            color: #11998e;
        }
        #calendar-view .calendar-week-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 8px;
        }
        #calendar-view .calendar-week-row div {
            text-align: center;
            font-weight: bold;
            color: #1a2980;
            font-size: 1.08rem;
            letter-spacing: 1px;
            padding-bottom: 2px;
        }
        #calendar-view .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 4px;
        }
        #calendar-view .calendar-cell {
            text-align: center;
            padding: 13px 0 8px 0;
            border-radius: 16px;
            font-size: 1.18rem;
            font-weight: 600;
            color: #1a2980;
            background: none;
            position: relative;
            cursor: pointer;
            transition: background 0.18s, color 0.18s, box-shadow 0.18s;
            min-width: 36px;
            min-height: 36px;
        }
        #calendar-view .calendar-cell.selected {
            background: linear-gradient(90deg,#1a2980,#26d0ce);
            color: #fff;
            box-shadow: 0 2px 12px rgba(26,41,128,0.18);
        }
        #calendar-view .calendar-cell.today:not(.selected) {
            background: linear-gradient(90deg,#e0e7ef,#b5c6e0);
            color: #1a2980;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(26,41,128,0.10);
        }
        #calendar-view .calendar-cell .calendar-badge {
            position: absolute;
            right: 8px;
            top: 7px;
            background: #FFD700;
            color: #8B4513;
            font-size: 0.85rem;
            border-radius: 50%;
            padding: 2px 7px 2px 7px;
            font-weight: bold;
            box-shadow: 0 1px 4px rgba(255,215,0,0.13);
            border: 1.5px solid #fff;
        }
        @media (max-width: 600px) {
            #calendar-view {
                min-width: 98vw;
                max-width: 99vw;
                padding: 10px 2vw 10px 2vw;
            }
        }
        #calendar-statistics-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 48px;
            margin: 40px auto 32px auto;
            max-width: 1100px;
            width: 100%;
        }
        #calendar-module-wrapper {
            margin: 0;
            min-width: 340px;
            max-width: 370px;
            flex: 0 0 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #calendar-view {
            min-width: 320px;
            max-width: 370px;
        }
        #stat-card-wrapper {
            display: flex;
            justify-content: center;
            margin: 36px auto 48px auto;
            max-width: 1400px;
            width: 100%;
        }
        .stat-card {
            background: #f6fafd;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(26,41,128,0.10);
            padding: 38px 56px 38px 56px;
            min-width: 480px;
            max-width: 700px;
            width: 100%;
            box-sizing: border-box;
            display: flex;
            align-items: center;
            justify-content: flex-start;
            position: relative;
            gap: 36px;
        }
        .stat-main-time {
            font-size: 2rem;
            font-weight: 900;
            color: #1a2980;
            letter-spacing: 1px;
            flex: 1;
            min-width: 180px;
        }
        .stat-completed-list {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
        }
        .stat-completed-item {
            background: #e0f7fa;
            color: #11998e;
            font-weight: bold;
            font-size: 1.08rem;
            border-radius: 16px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 90px;
        }
        .stat-completed-dot {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            vertical-align: middle;
        }
        .stat-reset-btn {
            position: absolute;
            top: 18px;
            right: 28px;
            background: #1a2980;
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 10px 22px;
            font-weight: bold;
            font-size: 1.08rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(26,41,128,0.13);
            z-index: 10;
            transition: background 0.2s;
        }
        .stat-reset-btn:hover {
            background: #26d0ce;
        }
        @media (max-width: 900px) {
            #stat-card-wrapper {
                max-width: 98vw;
            }
            .stat-card {
                min-width: 0;
                max-width: 98vw;
                width: 98vw;
                padding: 24px 4vw 24px 4vw;
                flex-direction: column;
                align-items: flex-start;
                gap: 18px;
            }
            .stat-main-time {
                font-size: 1.3rem;
            }
        }
        #calendar-motivation-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 48px;
            margin: 32px auto 0 auto;
            max-width: 1100px;
            width: 100%;
            min-height: 340px;
        }
        #calendar-module-wrapper {
            margin: 0;
            min-width: 320px;
            max-width: 370px;
            flex: 0 0 350px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #calendar-view {
            min-width: 320px;
            max-width: 370px;
        }
        #motivation-wrapper {
            flex: 1;
            min-width: 320px;
            max-width: 600px;
            display: flex;
            align-items: center;
            justify-content: flex-start;
        }
        .motivation {
            background: linear-gradient(to right, rgba(255,255,255,0.97), rgba(200,240,255,0.85));
            border-radius: 18px;
            box-shadow: 0 4px 18px rgba(26,41,128,0.10);
            padding: 36px 32px 36px 32px;
            margin: 0;
            width: 100%;
            min-width: 320px;
            max-width: 600px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .motivation .quote {
            font-size: 1.35rem;
            color: #1a2980;
            text-align: center;
            margin: 0 0 18px 0;
            line-height: 1.7;
            font-weight: 600;
        }
        .motivation .author {
            font-size: 1.08rem;
            color: #2c3e50;
            text-align: right;
            width: 100%;
            font-weight: bold;
        }
        .motivation i.fas.fa-quote-left {
            color: #ff7e4b;
            font-size: 2.2rem;
            margin-bottom: 12px;
        }
        @media (max-width: 900px) {
            #calendar-motivation-row {
                flex-direction: column;
                align-items: center;
                gap: 24px;
                margin-top: 18px;
            }
            #calendar-module-wrapper, #motivation-wrapper {
                max-width: 98vw;
                min-width: 0;
                width: 100%;
                justify-content: center;
            }
            .motivation {
                min-width: 0;
                width: 98vw;
                padding: 24px 8vw 24px 8vw;
            }
        }
        /* 卡片式并排布局 */
        #main-cards-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 48px;
            margin: 40px auto 0 auto;
            max-width: 1400px;
            width: 100%;
        }
        .main-card {
            background: #f6fafd;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(26,41,128,0.10);
            padding: 48px 56px 48px 56px;
            min-width: 480px;
            max-width: 700px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            min-height: 540px;
        }
        .main-card-title, .main-card-calendar-title {
            display: flex;
            align-items: center;
            font-size: 2.35rem;
            font-weight: 900;
            color: #1a2980;
            margin-bottom: 22px;
            letter-spacing: 1px;
        }
        .main-card-title i, .main-card-calendar-title i {
            font-size: 2.4rem;
            margin-right: 16px;
            color: #3ed2cc;
        }
        .main-card-divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #e0e7ef, #f6fafd 80%);
            margin: 0 0 32px 0;
            border: none;
        }
        .motto-list {
            width: 100%;
        }
        .motto-item {
            margin-bottom: 40px;
        }
        .motto-item:last-child {
            margin-bottom: 0;
        }
        .motto-quote {
            font-size: 1.45rem;
            color: #1a2980;
            font-weight: 700;
            line-height: 2.1;
            margin-bottom: 22px;
            text-align: left;
        }
        .motto-author {
            font-size: 1.18rem;
            color: #3e2de2;
            text-align: right;
            width: 100%;
            font-weight: bold;
        }
        .motto-author em {
            color: #4a00e0;
            font-style: normal;
        }
        .main-card-calendar-inner {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        @media (max-width: 1100px) {
            #main-cards-row {
                flex-direction: column;
                align-items: center;
                gap: 32px;
            }
            .main-card {
                min-width: 0;
                max-width: 98vw;
                width: 98vw;
                padding: 28px 4vw 28px 4vw;
                min-height: 0;
            }
        }
        /* 日历切换学习表动画 */
        .fade-in {
            animation: fadeInAnim 0.4s;
        }
        .fade-out {
            animation: fadeOutAnim 0.4s;
        }
        @keyframes fadeInAnim {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOutAnim {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        .timeline-scroll-container {
            height: 1000px;
            width: 100%;
            overflow-y: auto;
            padding-right: 2px;
            box-sizing: border-box;
        }
        @media (max-width: 900px) {
            .timeline-scroll-container {
                height: 700px;
                min-width: 0;
                width: 100%;
                max-width: 98vw;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-clock"></i> 考研复习时间表 <span class="update-badge">增强版</span></h1>
            <p class="subtitle">
                单科连续学习时间≤45分钟 | 英语三段式学习法 | 9:30开始学习<br>
                总学习时间：10小时15分钟 | 科目交叉安排 | 高效休息机制
            </p>
        </header>
        <!-- 主卡片区：日历和励志语录并排 -->
        <div id="main-cards-row" style="display:flex;flex-direction:row;justify-content:center;align-items:stretch;gap:48px;margin:40px auto 0 auto;max-width:1400px;width:100%;">
            <!-- 日历卡片 -->
            <div class="main-card" style="background:#f6fafd;border-radius:28px;box-shadow:0 6px 32px rgba(26,41,128,0.10);padding:48px 56px;min-width:480px;max-width:700px;width:100%;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;min-height:540px;">
                <div class="main-card-calendar-title" style="display:flex;align-items:center;font-size:2.35rem;font-weight:900;color:#1a2980;margin-bottom:22px;letter-spacing:1px;"><i class="fas fa-calendar-alt" style="font-size:2.4rem;margin-right:16px;color:#3ed2cc;"></i>学习日历</div>
                <div class="main-card-divider" style="width:100%;height:2px;background:linear-gradient(to right,#e0e7ef,#f6fafd 80%);margin:0 0 32px 0;border:none;"></div>
                <div class="main-card-calendar-inner" style="width:100%;display:flex;flex-direction:column;align-items:center;">
                    <div id="calendar-view"></div>
            </div>
            </div>
            <!-- 励志语录卡片 -->
            <div class="main-card" style="background:#f6fafd;border-radius:28px;box-shadow:0 6px 32px rgba(26,41,128,0.10);padding:48px 56px;min-width:480px;max-width:700px;width:100%;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start;min-height:540px;">
                <div class="main-card-title" style="display:flex;align-items:center;font-size:2.35rem;font-weight:900;color:#1a2980;margin-bottom:22px;letter-spacing:1px;"><i class="fas fa-quote-left" style="font-size:2.4rem;margin-right:16px;color:#3ed2cc;"></i>考研励志语录</div>
                <div class="main-card-divider" style="width:100%;height:2px;background:linear-gradient(to right,#e0e7ef,#f6fafd 80%);margin:0 0 32px 0;border:none;"></div>
                <div class="motto-list" style="width:100%;">
                    <div class="motto-item" style="margin-bottom:40px;">
                        <div class="motto-quote" style="font-size:1.45rem;color:#1a2980;font-weight:700;line-height:2.1;margin-bottom:22px;text-align:left;">"考研不是百米冲刺，而是马拉松。不在于某一天的爆发，而在于每一天的坚持。"</div>
                        <div class="motto-author" style="font-size:1.18rem;color:#3e2de2;text-align:right;width:100%;font-weight:bold;">—— <em style="color:#4a00e0;font-style:normal;">致每一位坚持的考研人</em></div>
            </div>
                    <div class="motto-item" style="margin-bottom:0;">
                        <div class="motto-quote" style="font-size:1.45rem;color:#1a2980;font-weight:700;line-height:2.1;margin-bottom:22px;text-align:left;">"努力是奇迹的另一个名字，坚持是成功的不二法门。"</div>
                        <div class="motto-author" style="font-size:1.18rem;color:#3e2de2;text-align:right;width:100%;font-weight:bold;">—— <em style="color:#4a00e0;font-style:normal;">考研路上的你</em></div>
        </div>
                </div>
            </div>
        </div>
        <!-- 隐藏的时间安排模板，供JS克隆用 -->
        <div id="timeline-template" style="display:none;">
            <div class="timeline-scroll-container">
            <div class="timeline">
                <div class="timeline-header">
                    <h2><i class="fas fa-calendar-alt"></i> 每日时间安排表 (9:30开始)</h2>
                </div>
                <div class="timeline-items">
                    <div class="timeline-item" data-duration="45">
                        <div class="time">9:30 - 10:15</div>
                        <div class="activity">
                            <div class="activity-title">高等数学 <span class="tomato"></span> 核心概念 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>定理推导与基础例题</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">10:15 - 10:25</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>眼部放松，补充水分</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item english-highlight" data-duration="30">
                        <div class="time">10:25 - 10:55</div>
                        <div class="activity">
                            <div class="activity-title">英语阅读 <span class="tomato"></span> 真题训练 <span class="duration">30分钟</span></div>
                            <div class="subject english">英语</div>
                            <p>阅读理解+长难句分析</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">10:55 - 11:05</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>简单拉伸，远眺放松</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">11:05 - 11:50</div>
                        <div class="activity">
                            <div class="activity-title">高等数学 <span class="tomato"></span> 习题巩固 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>典型题型强化训练</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="30">
                        <div class="time">11:50 - 12:20</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>准备午餐，放松调整</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="55">
                        <div class="time">12:20 - 13:15</div>
                        <div class="activity">
                            <div class="activity-title">午餐与放松 </div>
                            <div class="subject meal">休息</div>
                            <p>营养均衡，完全脱离学习环境</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">13:15 - 14:00</div>
                        <div class="activity">
                            <div class="activity-title">线性代数 <span class="tomato"></span> 矩阵运算 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>矩阵性质与基本运算</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">14:00 - 14:10</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>深呼吸，补充能量</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item english-highlight" data-duration="30">
                        <div class="time">14:10 - 14:40</div>
                        <div class="activity">
                            <div class="activity-title">英语词汇 <span class="tomato"></span> 核心记忆 <span class="duration">30分钟</span></div>
                            <div class="subject english">英语</div>
                            <p>高频词汇记忆与应用</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">14:40 - 14:50</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>轻度活动，补充水果</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">14:50 - 15:35</div>
                        <div class="activity">
                            <div class="activity-title">线性代数 <span class="tomato"></span> 向量空间 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>向量空间与线性变换</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">15:35 - 15:45</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>远眺放松，补充水分</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">15:45 - 16:30</div>
                        <div class="activity">
                            <div class="activity-title">专业课 <span class="tomato"></span> 重点突破 <span class="duration">45分钟</span></div>
                            <div class="subject major">专业课</div>
                            <p>核心概念深度学习</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">16:30 - 16:40</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>简单拉伸，呼吸新鲜空气</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">16:40 - 17:25</div>
                        <div class="activity">
                            <div class="activity-title">概率论 <span class="tomato"></span> 概率基础 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>基本概念与公式推导</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">17:25 - 18:10</div>
                        <div class="activity">
                            <div class="activity-title">晚餐与放松</div>
                            <div class="subject meal">休息</div>
                            <p>完全脱离学习环境</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">18:10 - 18:55</div>
                        <div class="activity">
                            <div class="activity-title">专业课 <span class="tomato"></span> 知识梳理 <span class="duration">45分钟</span></div>
                            <div class="subject major">专业课</div>
                            <p>知识体系构建与小结</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">18:55 - 19:05</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>眼部放松，轻度活动</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="45">
                        <div class="time">19:05 - 19:50</div>
                        <div class="activity">
                            <div class="activity-title">概率论 <span class="tomato"></span> 随机变量 <span class="duration">45分钟</span></div>
                            <div class="subject math">数学</div>
                            <p>随机变量分布与特征</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">19:50 - 20:00</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>补充能量，简单活动</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item english-highlight" data-duration="30">
                        <div class="time">20:00 - 20:30</div>
                        <div class="activity">
                            <div class="activity-title">英语写作 <span class="tomato"></span> 技巧训练 <span class="duration">30分钟</span></div>
                            <div class="subject english">英语</div>
                            <p>写作技巧与翻译训练</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">20:30 - 20:40</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>补充水分，深呼吸</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="60">
                        <div class="time">20:40 - 21:40</div>
                        <div class="activity">
                            <div class="activity-title">政治学习 <span class="tomato"></span> 理论+时政 <span class="update-badge">增加15分钟</span></div>
                            <div class="subject politics">政治</div>
                            <p>核心理论与时事分析</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始学习
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成学习
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="10">
                        <div class="time">21:40 - 21:50</div>
                        <div class="activity">
                            <div class="activity-title">短暂休息</div>
                            <div class="subject rest">休息</div>
                            <p>准备复盘</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始休息
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成休息
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                    <div class="timeline-item" data-duration="30">
                        <div class="time">21:50 - 22:20</div>
                        <div class="activity">
                            <div class="activity-title">当日复盘与明日计划</div>
                            <div class="subject review">复盘</div>
                            <p>总结收获，规划明日重点</p>
                        </div>
                        <div class="task-controls">
                            <button class="btn btn-start">
                                <i class="fas fa-play"></i> 开始复盘
                            </button>
                            <button class="btn btn-complete">
                                <i class="fas fa-check"></i> 完成复盘
                            </button>
                        </div>
                        <div class="timer"></div>
                    </div>
                </div>
            </div>
                </div>
                </div>
        <!-- 计时统计区和重置按钮并排 -->
        <div id="stat-row" style="display:flex;justify-content:center;align-items:center;gap:32px;margin:36px auto 48px auto;max-width:1400px;">
            <div id="stat-card-wrapper"></div>
            <button id="reset-today-btn" class="stat-reset-btn">重置今日记录</button>
        </div>
        <div id="back-to-ai-form-btn" style="text-align:center;margin:20px 0;">
            <a href="setup.html" style="color:#26d0ce;font-size:1.1rem;text-decoration:underline;">返回自定义设置</a>
        </div>
        <div id="study-page-container"></div>
                
        <div class="principles">
            <div class="principle-card">
                <i class="fas fa-brain"></i>
                <h3>专注力优化</h3>
                <p>单科连续学习≤45分钟，符合大脑注意力周期</p>
                </div>
            <div class="principle-card">
                <i class="fas fa-language"></i>
                <h3>英语三段学习</h3>
                <p>英语拆分为三个30分钟模块，提高记忆效率</p>
                    </div>
            <div class="principle-card">
                <i class="fas fa-heartbeat"></i>
                <h3>科学休息</h3>
                <p>每45分钟学习后休息5-10分钟，提升效率</p>
                    </div>
        </div>
        
        <footer>
            <p>高效考研时间表 | 英语三段学习法 | 遵循认知科学规律 © 2023</p>
            <p>提示：本时间表可根据个人学习节奏微调，保持规律作息是成功的关键</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ========== 日期与本地存储工具 ==========
            function getTodayStr() {
                const d = new Date();
                return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
            }
            function getMonthStr(date) {
                return date.getFullYear() + '-' + String(date.getMonth()+1).padStart(2, '0');
            }
            function getTaskStorageKey(dateStr) {
                return 'study_tasks_' + dateStr;
            }
            function getSummaryStorageKey(dateStr) {
                return 'study_summary_' + dateStr;
            }
            function getCompletedCount(tasks) {
                return tasks ? tasks.filter(Boolean).length : 0;
            }

            // ========== 全局当前查看日期 ==========
            let currentViewDate = getTodayStr();

            // ========== 自动重置任务状态 ========== 
            const todayStr = getTodayStr();
            const lastDate = localStorage.getItem('study_last_date');
            if (lastDate !== todayStr) {
                // 新的一天，重置所有任务状态
                document.querySelectorAll('.timeline-item').forEach((item, idx) => {
                    item.classList.remove('completed', 'active-task');
                    item.removeAttribute('data-remaining-seconds');
                    // 重置按钮
                    const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                    if (startBtn) {
                        startBtn.innerHTML = '<i class="fas fa-play"></i> ' + (item.querySelector('.subject.review') ? '开始复盘' : (item.querySelector('.subject.rest') ? '开始休息' : '开始学习'));
                        startBtn.className = 'btn btn-start';
                    }
                    const completeBtn = item.querySelector('.btn-complete');
                    if (completeBtn) {
                        completeBtn.innerHTML = '<i class="fas fa-check"></i> ' + (item.querySelector('.subject.review') ? '完成复盘' : (item.querySelector('.subject.rest') ? '完成休息' : '完成学习'));
                        completeBtn.classList.remove('completed');
                    }
                    // 重置计时器
                    const timer = item.querySelector('.timer');
                    if (timer) {
                        timer.textContent = '';
                        timer.classList.remove('timer-running', 'timer-completed');
                    }
                });
                // 清空今日任务完成状态
                localStorage.setItem(getTaskStorageKey(todayStr), JSON.stringify([]));
                // 清空今日总结
                localStorage.setItem(getSummaryStorageKey(todayStr), '');
                localStorage.setItem('study_last_date', todayStr);
            }

            // ========== 恢复任务完成状态 ========== 
            let taskItems = Array.from(document.querySelectorAll('.timeline-item'));
            let todayTasks = JSON.parse(localStorage.getItem(getTaskStorageKey(todayStr)) || '[]');
            taskItems.forEach((item, idx) => {
                if (todayTasks[idx]) {
                    // 标记为已完成
                    item.classList.add('completed');
                    item.classList.remove('active-task');
                    // 按钮
                    const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                    if (startBtn) {
                        startBtn.innerHTML = '<i class="fas fa-play"></i> 重新开始';
                        startBtn.classList.remove('btn-pause', 'btn-resume');
                        startBtn.classList.add('btn-start');
                    }
                    const completeBtn = item.querySelector('.btn-complete');
                    if (completeBtn) {
                        completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
                        completeBtn.classList.add('completed');
                    }
                    // 计时器
                    const timer = item.querySelector('.timer');
                    if (timer) {
                        timer.textContent = '00:00';
                        timer.classList.remove('timer-running');
                        timer.classList.add('timer-completed');
                    }
                }
            });

            // ========== 日历视图 ========== 
            function renderCalendar(monthDate) {
                const calendarDiv = document.getElementById('calendar-view');
                calendarDiv.innerHTML = '';
                const year = monthDate.getFullYear();
                const month = monthDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month+1, 0);
                const today = getTodayStr();
                // 标题
                const title = document.createElement('div');
                title.className = 'calendar-title';
                title.innerHTML = `<button class="calendar-header-btn" id="prev-month">&lt;</button>${year}年${month+1}月<button class="calendar-header-btn" id="next-month">&gt;</button>`;
                calendarDiv.appendChild(title);
                // 星期
                const weekRow = document.createElement('div');
                weekRow.className = 'calendar-week-row';
                ['日','一','二','三','四','五','六'].forEach(w=>{
                    const d = document.createElement('div');
                    d.textContent = w;
                    weekRow.appendChild(d);
                });
                calendarDiv.appendChild(weekRow);
                // 日期格
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                // 填充空白
                for(let i=0;i<firstDay.getDay();i++){
                    const empty = document.createElement('div');
                    grid.appendChild(empty);
                }
                // 填充日期
                for(let d=1;d<=lastDay.getDate();d++){
                    const dateStr = year+'-'+String(month+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    if(dateStr === today) cell.classList.add('today');
                    if(dateStr === currentViewDate) cell.classList.add('selected');
                    cell.textContent = d;
                    // 读取完成数和总数
                    const tasks = JSON.parse(localStorage.getItem(getTaskStorageKey(dateStr))||'[]');
                    const completed = getCompletedCount(tasks);
                    // 计算完成率并着色（修正版）
                    if (tasks.length > 0 && completed > 0) {
                        percent = completed / tasks.length;
                        if (percent === 1) {
                            cell.style.background = 'linear-gradient(90deg,#38ef7d,#11998e)';
                            cell.style.color = '#fff';
                        } else if (percent >= 0.5) {
                            cell.style.background = 'linear-gradient(90deg,#ffe259,#ffa751)';
                            cell.style.color = '#fff';
                        } else {
                            cell.style.background = 'linear-gradient(90deg,#ff5858,#f09819)';
                            cell.style.color = '#fff';
                        }
                    }
                    if(completed>0) {
                        const badge = document.createElement('span');
                        badge.textContent = completed;
                        badge.className = 'calendar-badge';
                        badge.title = '已完成任务数';
                        cell.appendChild(badge);
                    }
                    cell.addEventListener('click',()=>{
                        // 保存当前页面状态（只保存study-page-container里的卡片）
                        const timeline = document.querySelector('#study-page-container .timeline');
                        const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                        saveDayState(currentViewDate, taskItems);
                        currentViewDate = dateStr;
                        renderCalendar(new Date(year, month, 1));
                        // 动画：先fade-out
                        const container = document.getElementById('study-page-container');
                        container.classList.remove('fade-in');
                        container.classList.add('fade-out');
                        setTimeout(()=>{
                            container.innerHTML = '';
                            // 克隆模板
                            const template = document.querySelector('#timeline-template .timeline');
                            if (template) {
                                const timelineClone = template.cloneNode(true);
                                // 修改标题为日期
                                const header = timelineClone.querySelector('.timeline-header');
                                if (header) {
                                    header.innerHTML = `<h2 id="schedule-title" style="font-size:1.25rem;color:#1a2980;font-weight:bold;margin:0 0 10px 0;display:inline-block;vertical-align:middle;"><i class='fas fa-calendar-alt'></i> ${dateStr} 时间安排表</h2>`;
                                    header.style.background = 'none';
                                    header.style.color = '#1a2980';
                                    header.style.boxShadow = 'none';
                                    header.style.border = 'none';
                                    header.style.padding = '18px 0 8px 0';
                                }
                                // 恢复该日期的任务和计时器状态
                                const items = Array.from(timelineClone.querySelectorAll('.timeline-item'));
                                restoreDayState(dateStr, items);
                                const scrollContainer = document.createElement('div');
                                scrollContainer.className = 'timeline-scroll-container';
                                scrollContainer.appendChild(timelineClone);
                                container.appendChild(scrollContainer);
                            }
                            container.classList.remove('fade-out');
                            container.classList.add('fade-in');
                        }, 400);
                    });
                    grid.appendChild(cell);
                }
                calendarDiv.appendChild(grid);
                // 月份切换
                document.getElementById('prev-month').onclick = ()=>{
                    renderCalendar(new Date(year, month-1, 1));
                };
                document.getElementById('next-month').onclick = ()=>{
                    renderCalendar(new Date(year, month+1, 1));
                };
            }

            // ========== 渲染学习页面（时间表+总结） ========== 
            // 复制原有 .schedule-container 和 .notes 区域，动态渲染
            function renderStudyPage(dateStr) {
                const container = document.getElementById('study-page-container');
                if (dateStr !== getTodayStr()) {
                    container.innerHTML = '';
                    return;
                }
                // 任务模板
                const timeline = document.querySelector('#timeline-template .timeline');
                if (!timeline) return;
                // 只复制时间表部分，不复制大卡片和头部
                const timelineClone = timeline.cloneNode(true);
                // 修改标题为日期（不再用大卡片背景）
                const header = timelineClone.querySelector('.timeline-header');
                if (header) {
                    header.innerHTML = `<h2 id="schedule-title" style="font-size:1.25rem;color:#1a2980;font-weight:bold;margin:0 0 10px 0;display:inline-block;vertical-align:middle;"><i class='fas fa-calendar-alt'></i> ${dateStr} 时间安排表</h2>`;
                    header.style.background = 'none';
                    header.style.color = '#1a2980';
                    header.style.boxShadow = 'none';
                    header.style.border = 'none';
                    header.style.padding = '18px 0 8px 0';
                }
                const taskItems = Array.from(timelineClone.querySelectorAll('.timeline-item'));
                restoreDayState(dateStr, taskItems);
                timelineClone.querySelector('.timeline-items').addEventListener('click', function(e) {
                    const target = e.target;
                    const btn = target.closest('.btn');
                    if (!btn) return;
                    const taskItem = btn.closest('.timeline-item');
                    if (!taskItem) return;
                    const idx = taskItems.indexOf(taskItem);
                    if(idx===-1) return;
                    // 开始
                    if (btn.classList.contains('btn-start')) {
                        if (taskItem.classList.contains('completed')) return;
                        if (globalActiveTask && globalActiveTask !== taskItem) {
                            pauseTask(globalActiveTask);
                        }
                        globalActiveTask = taskItem;
                        taskItem.classList.add('active-task');
                        const duration = parseInt(taskItem.dataset.duration) * 60;
                        let remainingSeconds = taskItem.dataset.remainingSeconds 
                            ? parseInt(taskItem.dataset.remainingSeconds) 
                            : duration;
                        const startBtn = taskItem.querySelector('.btn-start, .btn-resume');
                        startBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                        startBtn.classList.remove('btn-start', 'btn-resume');
                        startBtn.classList.add('btn-pause');
                        if (globalTimerInterval) clearInterval(globalTimerInterval);
                        globalTimerInterval = setInterval(function() {
                            remainingSeconds--;
                            taskItem.dataset.remainingSeconds = remainingSeconds;
                            updateTimerDisplay(taskItem, remainingSeconds);
                            updateStatCard(dateStr);
                            saveDayState(dateStr, taskItems);
                            if (remainingSeconds <= 0) {
                                clearInterval(globalTimerInterval);
                                globalTimerInterval = null;
                                completeTask(taskItem);
                            }
                        }, 1000);
                        updateTimerDisplay(taskItem, remainingSeconds);
                        updateStatCard(dateStr);
                        saveDayState(dateStr, taskItems);
                    }
                    // 暂停
                    else if (btn.classList.contains('btn-pause')) {
                        if (taskItem !== globalActiveTask) return;
                        if (globalTimerInterval) {
                            clearInterval(globalTimerInterval);
                            globalTimerInterval = null;
                        }
                        const pauseBtn = taskItem.querySelector('.btn-pause');
                        pauseBtn.innerHTML = '<i class="fas fa-play"></i> 继续';
                        pauseBtn.classList.remove('btn-pause');
                        pauseBtn.classList.add('btn-resume');
                        const timerDisplay = taskItem.querySelector('.timer');
                        if (timerDisplay) timerDisplay.classList.remove('timer-running');
                        updateStatCard(dateStr);
                        saveDayState(dateStr, taskItems);
                    }
                    // 继续
                    else if (btn.classList.contains('btn-resume')) {
                        if (taskItem !== globalActiveTask) return;
                        let remainingSeconds = parseInt(taskItem.dataset.remainingSeconds);
                        const resumeBtn = taskItem.querySelector('.btn-resume');
                        resumeBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                        resumeBtn.classList.remove('btn-resume');
                        resumeBtn.classList.add('btn-pause');
                        const timerDisplay = taskItem.querySelector('.timer');
                        if (timerDisplay) timerDisplay.classList.add('timer-running');
                        globalTimerInterval = setInterval(function() {
                            let seconds = parseInt(taskItem.dataset.remainingSeconds) - 1;
                            taskItem.dataset.remainingSeconds = seconds;
                            updateTimerDisplay(taskItem, seconds);
                            updateStatCard(dateStr);
                            saveDayState(dateStr, taskItems);
                            if (seconds <= 0) {
                                clearInterval(globalTimerInterval);
                                globalTimerInterval = null;
                                completeTask(taskItem);
                            }
                        }, 1000);
                        updateStatCard(dateStr);
                        saveDayState(dateStr, taskItems);
                    }
                    // 完成
                    else if (btn.classList.contains('btn-complete')) {
                        completeTask(taskItem);
                        const tasks = JSON.parse(localStorage.getItem(getTaskStorageKey(dateStr)) || '[]');
                        tasks[idx] = true;
                        localStorage.setItem(getTaskStorageKey(dateStr), JSON.stringify(tasks));
                        renderCalendar(new Date(dateStr));
                        renderStudyPage(dateStr);
                        updateStatCard(dateStr);
                        saveDayState(dateStr, taskItems);
                    }
                    // 计时器显示
                    function updateTimerDisplay(taskItem, seconds) {
                        const timerDisplay = taskItem.querySelector('.timer');
                        if (!timerDisplay) return;
                        if (seconds <= 0) {
                            timerDisplay.textContent = '00:00';
                            timerDisplay.classList.remove('timer-running');
                            timerDisplay.classList.add('timer-completed');
                            return;
                        }
                        const mins = Math.floor(seconds / 60);
                        const secs = seconds % 60;
                        timerDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                        if (taskItem === globalActiveTask) {
                            timerDisplay.classList.add('timer-running');
                        } else {
                            timerDisplay.classList.remove('timer-running');
                        }
                    }
                    // 完成任务
                    function completeTask(taskItem) {
                        if (globalTimerInterval) {
                            clearInterval(globalTimerInterval);
                            globalTimerInterval = null;
                        }
                        taskItem.classList.add('completed');
                        taskItem.classList.remove('active-task');
                        const startBtn = taskItem.querySelector('.btn-start, .btn-pause, .btn-resume');
                        if (startBtn) {
                            startBtn.innerHTML = '<i class="fas fa-play"></i> 重新开始';
                            startBtn.classList.remove('btn-pause', 'btn-resume');
                            startBtn.classList.add('btn-start');
                        }
                        const completeBtn = taskItem.querySelector('.btn-complete');
                        if (completeBtn) {
                            completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
                            completeBtn.classList.add('completed');
                        }
                        updateTimerDisplay(taskItem, 0);
                        if (taskItem === globalActiveTask) {
                            globalActiveTask = null;
                        }
                        updateStatCard(dateStr);
                        saveDayState(dateStr, taskItems);
                    }
                });
                container.innerHTML = '';
                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'timeline-scroll-container';
                scrollContainer.appendChild(timelineClone);
                container.appendChild(scrollContainer);
                restoreDayState(dateStr, taskItems);
            }

            // ========== 首次渲染 ========== 
            renderCalendar(new Date());
            renderStudyPage(currentViewDate);

            // ========== 保持原有计时器/按钮功能（仅今日页面生效） ========== 
            // 存储当前活动任务和计时器
            let globalActiveTask = null;
            let globalTimerInterval = null;
            
            // 为所有按钮添加事件委托
            document.querySelector('.timeline-items').addEventListener('click', function(e) {
                const target = e.target;
                const btn = target.closest('.btn');
                if (!btn) return;
                
                const taskItem = btn.closest('.timeline-item');
                if (!taskItem) return;
                
                // 处理开始/暂停/继续按钮
                if (btn.classList.contains('btn-start')) {
                    startTask(taskItem);
                } 
                else if (btn.classList.contains('btn-pause')) {
                    pauseTask(taskItem);
                } 
                else if (btn.classList.contains('btn-resume')) {
                    resumeTask(taskItem);
                } 
                // 处理完成按钮
                else if (btn.classList.contains('btn-complete')) {
                    completeTask(taskItem);
                }
            });
            
            // 开始任务
            function startTask(taskItem) {
                // 如果任务已完成，不能再次开始
                if (taskItem.classList.contains('completed')) return;
                
                // 如果已有活动任务，先暂停它
                if (globalActiveTask && globalActiveTask !== taskItem) {
                    pauseTask(globalActiveTask);
                }
                
                // 设置新活动任务
                globalActiveTask = taskItem;
                taskItem.classList.add('active-task');
                
                // 获取任务持续时间（分钟）并转换为秒
                const duration = parseInt(taskItem.dataset.duration) * 60;
                
                // 初始化或恢复剩余时间
                let remainingSeconds = taskItem.dataset.remainingSeconds 
                    ? parseInt(taskItem.dataset.remainingSeconds) 
                    : duration;
                
                // 更新按钮状态
                const startBtn = taskItem.querySelector('.btn-start, .btn-resume');
                startBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                startBtn.classList.remove('btn-start', 'btn-resume');
                startBtn.classList.add('btn-pause');
                
                // 清除现有计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                }
                
                // 开始计时器
                globalTimerInterval = setInterval(function() {
                    remainingSeconds--;
                    taskItem.dataset.remainingSeconds = remainingSeconds;
                    
                    // 更新显示
                    updateTimerDisplay(taskItem, remainingSeconds);
                    
                    // 检查是否结束
                    if (remainingSeconds <= 0) {
                        clearInterval(globalTimerInterval);
                        globalTimerInterval = null;
                        completeTask(taskItem);
                    }
                }, 1000);
                
                // 初始化显示
                updateTimerDisplay(taskItem, remainingSeconds);
            }
            
            // 暂停任务
            function pauseTask(taskItem) {
                // 确保暂停的是当前活动任务
                if (taskItem !== globalActiveTask) return;
                
                // 清除计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                    globalTimerInterval = null;
                }
                
                // 更新按钮状态
                const pauseBtn = taskItem.querySelector('.btn-pause');
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> 继续';
                pauseBtn.classList.remove('btn-pause');
                pauseBtn.classList.add('btn-resume');
                
                // 移除高亮动画
                const timerDisplay = taskItem.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.classList.remove('timer-running');
                }
            }
            
            // 继续任务
            function resumeTask(taskItem) {
                // 确保继续的是当前活动任务
                if (taskItem !== globalActiveTask) return;
                
                // 获取剩余时间
                const remainingSeconds = parseInt(taskItem.dataset.remainingSeconds);
                
                // 更新按钮状态
                const resumeBtn = taskItem.querySelector('.btn-resume');
                resumeBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                resumeBtn.classList.remove('btn-resume');
                resumeBtn.classList.add('btn-pause');
                
                // 添加高亮动画
                const timerDisplay = taskItem.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.classList.add('timer-running');
                }
                
                // 开始计时器
                globalTimerInterval = setInterval(function() {
                    let seconds = parseInt(taskItem.dataset.remainingSeconds) - 1;
                    taskItem.dataset.remainingSeconds = seconds;
                    
                    // 更新显示
                    updateTimerDisplay(taskItem, seconds);
                    
                    // 检查是否结束
                    if (seconds <= 0) {
                        clearInterval(globalTimerInterval);
                        globalTimerInterval = null;
                        completeTask(taskItem);
                    }
                }, 1000);
            }
            
            // 完成任务
            function completeTask(taskItem) {
                // 清除计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                    globalTimerInterval = null;
                }
                
                // 标记任务为完成
                taskItem.classList.add('completed');
                taskItem.classList.remove('active-task');
                
                // 更新按钮状态
                const startBtn = taskItem.querySelector('.btn-start, .btn-pause, .btn-resume');
                if (startBtn) {
                    startBtn.innerHTML = '<i class="fas fa-play"></i> 重新开始';
                    startBtn.classList.remove('btn-pause', 'btn-resume');
                    startBtn.classList.add('btn-start');
                }
                
                // 更新完成按钮
                const completeBtn = taskItem.querySelector('.btn-complete');
                if (completeBtn) {
                    completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
                    completeBtn.classList.add('completed');
                }
                
                // 更新计时器显示
                updateTimerDisplay(taskItem, 0);
                
                // 重置活动任务
                if (taskItem === globalActiveTask) {
                    globalActiveTask = null;
                }
            }
            
            // 更新计时器显示
            function updateTimerDisplay(taskItem, seconds) {
                const timerDisplay = taskItem.querySelector('.timer');
                if (!timerDisplay) return;
                
                if (seconds <= 0) {
                    timerDisplay.textContent = '00:00';
                    timerDisplay.classList.remove('timer-running');
                    timerDisplay.classList.add('timer-completed');
                    return;
                }
                
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                // 添加高亮动画
                if (taskItem === globalActiveTask) {
                    timerDisplay.classList.add('timer-running');
                } else {
                    timerDisplay.classList.remove('timer-running');
                }
            }

            // 统计区渲染函数，供计时/完成等操作实时调用
            function updateStatCard(dateStr) {
                const wrapper = document.getElementById('stat-card-wrapper');
                if (!wrapper) return;
                // 统计当前页面study-page-container里的卡片
                const timeline = document.querySelector('#study-page-container .timeline');
                const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                let totalSeconds = 0;
                let completedSubjectSeconds = { math: 0, english: 0, major: 0, politics: 0, rest: 0, meal: 0, review: 0 };
                let subjectNames = { math: '数学', english: '英语', major: '专业课', politics: '政治', rest: '休息', meal: '休息', review: '复盘' };
                let subjectColors = {
                    math: '#ff416c', english: '#2193b0', major: '#38ef7d', politics: '#8e2de2', rest: '#ffb199', meal: '#fecfef', review: '#00c6ff'
                };
                taskItems.forEach((item) => {
                    let duration = parseInt(item.dataset.duration) * 60;
                    let used = 0;
                    if (item.dataset.remainingSeconds) {
                        let remain = parseInt(item.dataset.remainingSeconds);
                        used = duration - remain;
                        if (used < 0) used = 0;
                    }
                    totalSeconds += used;
                    // 统计已完成各科目时长
                    if (item.classList.contains('completed')) {
                        const subject = item.querySelector('.subject');
                        let key = null;
                        if (subject) {
                            if (subject.classList.contains('math')) key = 'math';
                            else if (subject.classList.contains('english')) key = 'english';
                            else if (subject.classList.contains('major')) key = 'major';
                            else if (subject.classList.contains('politics')) key = 'politics';
                            else if (subject.classList.contains('rest')) key = 'rest';
                            else if (subject.classList.contains('meal')) key = 'meal';
                            else if (subject.classList.contains('review')) key = 'review';
                        }
                        if (key && completedSubjectSeconds[key] !== undefined) {
                            completedSubjectSeconds[key] += used;
                        }
                    }
                });
                // 渲染统计卡片内容
                let hour = Math.floor(totalSeconds / 3600);
                let min = Math.floor((totalSeconds % 3600) / 60);
                let sec = totalSeconds % 60;
                let timeStr = (hour > 0 ? `${hour}小时` : '') + (min > 0 ? `${min}分` : (hour === 0 ? (sec > 0 ? '' : '0分') : '')) + (sec > 0 ? `${sec}秒` : (hour === 0 && min === 0 ? '0秒' : ''));
                let html = `<div class="stat-card">
                    <div class="stat-main-time"><i class='fas fa-hourglass-half' style='margin-right:10px;'></i>今日已学习：<span style='color:#26d0ce;'>${timeStr}</span></div>`;
                // 已完成各科目时长
                let completedKeys = Object.keys(completedSubjectSeconds).filter(k => completedSubjectSeconds[k] > 0);
                if (completedKeys.length > 0) {
                    html += `<div class='stat-completed-list'>`;
                    completedKeys.forEach(key => {
                        let sec = completedSubjectSeconds[key];
                        let h = Math.floor(sec / 3600);
                        let m = Math.floor((sec % 3600) / 60);
                        let s = sec % 60;
                        let str = (h > 0 ? `${h}小时` : '') + (m > 0 ? `${m}分` : (h === 0 ? (s > 0 ? '' : '0分') : '')) + (s > 0 ? `${s}秒` : (h === 0 && m === 0 ? '0秒' : ''));
                        html += `<div class='stat-completed-item'><span class='stat-completed-dot' style='background:${subjectColors[key]};'></span>${subjectNames[key]}：<span style='color:#11998e;'>${str}</span></div>`;
                    });
                    html += `</div>`;
                }
                // 重置按钮
                html += `<button id="reset-today-btn" class="stat-reset-btn">重置今日记录</button>`;
                html += `</div>`;
                wrapper.innerHTML = html;
                // 绑定重置按钮事件
                const resetBtn = document.getElementById('reset-today-btn');
                if (resetBtn) {
                    resetBtn.onclick = function() {
                        if(confirm('确定要重置今日所有学习记录吗？')) {
                            localStorage.setItem(getTaskStorageKey(dateStr), JSON.stringify([]));
                            localStorage.setItem(getSummaryStorageKey(dateStr), '');
                            localStorage.setItem('study_timer_' + dateStr, JSON.stringify([]));
                            // 清空所有卡片的计时状态（包括克隆和主页面）
                            const timeline = document.querySelector('#timeline-template .timeline');
                            const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                            if (timeline) {
                                taskItems.forEach(item => {
                                    item.removeAttribute('data-remaining-seconds');
                                    item.classList.remove('completed');
                                });
                            }
                            // 立即刷新统计区和页面
                            renderStatCard(dateStr);
                            renderStudyPage(dateStr);
                        }
                    };
                }
            }

            // 每秒自动刷新统计区，保证总时长实时等于各部分之和
            setInterval(function() {
                const todayStr = getTodayStr();
                updateStatCard(todayStr);
            }, 1000);

            // 保存/恢复计时进度和完成状态到localStorage
            function saveDayState(dateStr, taskItems) {
                // 保存每个卡片的剩余秒数和完成状态
                const timers = [];
                const completed = [];
                taskItems.forEach(item => {
                    timers.push(item.dataset.remainingSeconds ? parseInt(item.dataset.remainingSeconds) : null);
                    completed.push(item.classList.contains('completed'));
                });
                localStorage.setItem('study_timer_' + dateStr, JSON.stringify(timers));
                localStorage.setItem('study_tasks_' + dateStr, JSON.stringify(completed));
            }
            function restoreDayState(dateStr, taskItems) {
                // 恢复每个卡片的剩余秒数和完成状态
                const timers = JSON.parse(localStorage.getItem('study_timer_' + dateStr) || '[]');
                const completed = JSON.parse(localStorage.getItem('study_tasks_' + dateStr) || '[]');
                taskItems.forEach((item, idx) => {
                    if (timers[idx] !== undefined && timers[idx] !== null) {
                        item.dataset.remainingSeconds = timers[idx];
                    } else {
                        item.removeAttribute('data-remaining-seconds');
                    }
                    if (completed[idx]) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                });
            }

            // 切换日期时自动恢复状态
            restoreDayState(dateStr, taskItems);

            // 切换日期时自动保存当前页面状态，再恢复目标日期状态
            let lastViewDate = getTodayStr();
            function switchDayAndRender(newDateStr, taskItems) {
                // 保存当前页面状态
                saveDayState(lastViewDate, taskItems);
                // 恢复目标日期状态
                restoreDayState(newDateStr, taskItems);
                lastViewDate = newDateStr;
            }

            // 新增：专门渲染计时统计区和重置按钮
            function renderStatCard(dateStr) {
                const wrapper = document.getElementById('stat-card-wrapper');
                if (!wrapper) return;
                // 统计当前页面study-page-container里的卡片
                const timeline = document.querySelector('#study-page-container .timeline');
                const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                let totalSeconds = 0;
                let completedSubjectSeconds = { math: 0, english: 0, major: 0, politics: 0, rest: 0, meal: 0, review: 0 };
                let subjectNames = { math: '数学', english: '英语', major: '专业课', politics: '政治', rest: '休息', meal: '休息', review: '复盘' };
                let subjectColors = {
                    math: '#ff416c', english: '#2193b0', major: '#38ef7d', politics: '#8e2de2', rest: '#ffb199', meal: '#fecfef', review: '#00c6ff'
                };
                taskItems.forEach((item) => {
                    let duration = parseInt(item.dataset.duration) * 60;
                    let used = 0;
                    if (item.dataset.remainingSeconds) {
                        let remain = parseInt(item.dataset.remainingSeconds);
                        used = duration - remain;
                        if (used < 0) used = 0;
                    }
                    totalSeconds += used;
                    // 统计已完成各科目时长
                    if (item.classList.contains('completed')) {
                        const subject = item.querySelector('.subject');
                        let key = null;
                        if (subject) {
                            if (subject.classList.contains('math')) key = 'math';
                            else if (subject.classList.contains('english')) key = 'english';
                            else if (subject.classList.contains('major')) key = 'major';
                            else if (subject.classList.contains('politics')) key = 'politics';
                            else if (subject.classList.contains('rest')) key = 'rest';
                            else if (subject.classList.contains('meal')) key = 'meal';
                            else if (subject.classList.contains('review')) key = 'review';
                        }
                        if (key && completedSubjectSeconds[key] !== undefined) {
                            completedSubjectSeconds[key] += used;
                        }
                    }
                });
                // 渲染统计卡片内容
                let hour = Math.floor(totalSeconds / 3600);
                let min = Math.floor((totalSeconds % 3600) / 60);
                let sec = totalSeconds % 60;
                let timeStr = (hour > 0 ? `${hour}小时` : '') + (min > 0 ? `${min}分` : (hour === 0 ? (sec > 0 ? '' : '0分') : '')) + (sec > 0 ? `${sec}秒` : (hour === 0 && min === 0 ? '0秒' : ''));
                let html = `<div class="stat-card">
                    <div class="stat-main-time"><i class='fas fa-hourglass-half' style='margin-right:10px;'></i>今日已学习：<span style='color:#26d0ce;'>${timeStr}</span></div>`;
                // 已完成各科目时长
                let completedKeys = Object.keys(completedSubjectSeconds).filter(k => completedSubjectSeconds[k] > 0);
                if (completedKeys.length > 0) {
                    html += `<div class='stat-completed-list'>`;
                    completedKeys.forEach(key => {
                        let sec = completedSubjectSeconds[key];
                        let h = Math.floor(sec / 3600);
                        let m = Math.floor((sec % 3600) / 60);
                        let s = sec % 60;
                        let str = (h > 0 ? `${h}小时` : '') + (m > 0 ? `${m}分` : (h === 0 ? (s > 0 ? '' : '0分') : '')) + (s > 0 ? `${s}秒` : (h === 0 && m === 0 ? '0秒' : ''));
                        html += `<div class='stat-completed-item'><span class='stat-completed-dot' style='background:${subjectColors[key]};'></span>${subjectNames[key]}：<span style='color:#11998e;'>${str}</span></div>`;
                    });
                    html += `</div>`;
                }
                // 重置按钮
                html += `<button id="reset-today-btn" class="stat-reset-btn">重置今日记录</button>`;
                html += `</div>`;
                wrapper.innerHTML = html;
                // 绑定重置按钮事件
                const resetBtn = document.getElementById('reset-today-btn');
                if (resetBtn) {
                    resetBtn.onclick = function() {
                        if(confirm('确定要重置今日所有学习记录吗？')) {
                            localStorage.setItem(getTaskStorageKey(dateStr), JSON.stringify([]));
                            localStorage.setItem(getSummaryStorageKey(dateStr), '');
                            localStorage.setItem('study_timer_' + dateStr, JSON.stringify([]));
                            // 清空所有卡片的计时状态（包括克隆和主页面）
                            const timeline = document.querySelector('#timeline-template .timeline');
                            const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                            if (timeline) {
                                taskItems.forEach(item => {
                                    item.removeAttribute('data-remaining-seconds');
                                    item.classList.remove('completed');
                                });
                            }
                            // 立即刷新统计区和页面
                            renderStatCard(dateStr);
                            renderStudyPage(dateStr);
                        }
                    };
                }
            }
            // renderStudyPage 只刷新study-page-container
            // 切换日期时：renderStatCard(currentViewDate); renderStudyPage(currentViewDate);

            // 1. 在JS中定时检查所有已设置提醒时间的任务，若到点则弹窗提醒
            setInterval(function() {
                // 只检查当前页面的.timeline-item
                const timeline = document.querySelector('#study-page-container .timeline');
                if (!timeline) return;
                const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                const now = new Date();
                items.forEach((item, idx) => {
                    const input = item.querySelector('.remind-time-input');
                    if (!input) return;
                    const remindTime = input.value;
                    if (!remindTime) return;
                    // 检查是否已提醒过
                    if (input.dataset.reminded === '1') return;
                    // 解析时间
                    const [h, m] = remindTime.split(':');
                    if (h === undefined || m === undefined) return;
                    const remindDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(h), parseInt(m), 0);
                    // 允许1分钟误差
                    if (now >= remindDate && now - remindDate < 60000) {
                        // 弹窗提醒
                        const title = item.querySelector('.activity-title')?.innerText || '任务提醒';
                        const detail = item.querySelector('.activity p')?.innerText || '';
                        alert(`任务提醒：${title}\n${detail}`);
                        input.dataset.reminded = '1';
                    }
                });
            }, 20000); // 每20秒检查一次

            // JS部分：初始化任务下拉框、设置提醒、定时检查
            let globalRemindList = [];
            function updateRemindTaskSelect() {
                const select = document.getElementById('remind-task-select');
                if (!select) return;
                select.innerHTML = '';
                // 获取当前页面所有任务
                const timeline = document.querySelector('#study-page-container .timeline');
                if (!timeline) return;
                const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                items.forEach((item, idx) => {
                    const title = item.querySelector('.activity-title')?.innerText || `任务${idx+1}`;
                    const option = document.createElement('option');
                    option.value = idx;
                    option.textContent = title;
                    select.appendChild(option);
                });
            }
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(updateRemindTaskSelect, 800); // 首次渲染后初始化
            });
            // 切换日期后也要刷新下拉框
            const origRenderStudyPage = renderStudyPage;
            renderStudyPage = function(dateStr) {
                origRenderStudyPage(dateStr);
                setTimeout(updateRemindTaskSelect, 200);
            };
            // 设置提醒按钮
            const remindBtn = document.getElementById('set-remind-btn');
            if (remindBtn) {
                remindBtn.onclick = function() {
                    const select = document.getElementById('remind-task-select');
                    const timeInput = document.getElementById('remind-time-input');
                    if (!select || !timeInput) return;
                    const idx = select.value;
                    const time = timeInput.value;
                    if (!time) { alert('请选择提醒时间'); return; }
                    // 获取任务信息
                    const timeline = document.querySelector('#study-page-container .timeline');
                    if (!timeline) return;
                    const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                    const item = items[idx];
                    if (!item) return;
                    const title = item.querySelector('.activity-title')?.innerText || '任务提醒';
                    const detail = item.querySelector('.activity p')?.innerText || '';
                    globalRemindList.push({ idx: Number(idx), time, title, detail, reminded: false, date: getTodayStr() });
                    alert('提醒已设置！');
                };
            }
            // 定时检查提醒
            setInterval(function() {
                const now = new Date();
                globalRemindList.forEach(remind => {
                    if (remind.reminded) return;
                    if (remind.date !== getTodayStr()) return; // 只提醒今天
                    const [h, m] = remind.time.split(':');
                    if (h === undefined || m === undefined) return;
                    const remindDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(h), parseInt(m), 0);
                    if (now >= remindDate && now - remindDate < 60000) {
                        alert(`任务提醒：${remind.title}\n${remind.detail}`);
                        remind.reminded = true;
                    }
                });
            }, 20000);

            // 确保始终插入返回按钮
            let studyPage = document.getElementById('study-page-container');
            if (studyPage && !document.getElementById('back-to-ai-form-btn')) {
                let backBtn = document.createElement('div');
                backBtn.id = 'back-to-ai-form-btn';
                backBtn.style = 'text-align:center;margin:20px 0;';
                backBtn.innerHTML = '<a href="setup.html" style="color:#26d0ce;font-size:1.1rem;text-decoration:underline;">返回自定义设置</a>';
                studyPage.parentNode.insertBefore(backBtn, studyPage);
            }


            // 生成协调的渐变色对
            function generateSubjectColors(count) {
                const colors = [];
                const hueStep = 360 / count;
                for (let i = 0; i < count; i++) {
                    const hue = (i * hueStep) % 360;
                    colors.push({
                        start: `hsl(${hue}, 70%, 50%)`,
                        end: `hsl(${(hue + 30) % 360}, 70%, 60%)`
                    });
                }
                return colors;
            }
            document.addEventListener('DOMContentLoaded', function() {
                // 尝试获取自定义参数
                const customParams = localStorage.getItem('custom_schedule_params');
                let scheduleParams = DEFAULT_PARAMS;
                
                if (customParams) {
                    try {
                        scheduleParams = JSON.parse(customParams);
                        // 确保有subjects数组
                        if (!scheduleParams.subjects || !Array.isArray(scheduleParams.subjects)) {
                            scheduleParams.subjects = DEFAULT_PARAMS.subjects;
                        }
                    } catch (e) {
                        console.error("解析自定义参数失败", e);
                    }
                }
                
                // 生成时间表
                generateCustomSchedule(scheduleParams);
            });
        });
    </script>
</body>
</html>