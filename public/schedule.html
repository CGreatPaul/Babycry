<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>考研复习时间表 | 增强版</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            color: #2c3e50;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        /* 移动端基础优化 */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
        }
        
        @media (max-width: 480px) {
            body {
                padding: 8px;
            }
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 32px 0 64px 0;
        }
        
        /* 移动端容器优化 */
        @media (max-width: 768px) {
            .container {
                padding: 20px 0 40px 0;
                max-width: 100%;
            }
        }
        
        @media (max-width: 480px) {
            .container {
                padding: 16px 0 32px 0;
            }
        }
        
        /* 欢迎动画样式 */
        .welcome-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #1a2980, #26d0ce);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            transition: opacity 0.8s ease-out;
        }
        
        .welcome-overlay.fade-out {
            opacity: 0;
            pointer-events: none;
        }
        
        .welcome-content {
            text-align: center;
            color: white;
            animation: welcomeFadeIn 1.5s ease-out;
        }
        
        .welcome-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: welcomeBounce 2s ease-in-out infinite;
        }
        
        .welcome-title {
            font-size: 2.5rem;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .welcome-subtitle {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 30px;
        }
        
        .loading-bar {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 2px;
            overflow: hidden;
            margin: 0 auto;
        }
        
        .loading-progress {
            height: 100%;
            background: linear-gradient(90deg, #fff, #26d0ce);
            width: 0%;
            animation: loadingProgress 2s ease-out forwards;
        }
        
        @keyframes welcomeFadeIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        @keyframes welcomeBounce {
            0%, 20%, 50%, 80%, 100% {
                transform: translateY(0);
            }
            40% {
                transform: translateY(-10px);
            }
            60% {
                transform: translateY(-5px);
            }
        }
        
        @keyframes loadingProgress {
            from {
                width: 0%;
            }
            to {
                width: 100%;
            }
        }
        
        /* 欢迎动画移动端优化 */
        @media (max-width: 768px) {
            .welcome-content {
                padding: 20px;
                text-align: center;
            }
            
            .welcome-title {
                font-size: 1.8rem;
                margin-bottom: 12px;
            }
            
            .welcome-subtitle {
                font-size: 1rem;
                margin-bottom: 24px;
            }
            
            .welcome-icon {
                font-size: 3rem;
                margin-bottom: 20px;
            }
            
            .loading-bar {
                width: 200px;
                height: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .welcome-title {
                font-size: 1.5rem;
                margin-bottom: 10px;
            }
            
            .welcome-subtitle {
                font-size: 0.9rem;
                margin-bottom: 20px;
            }
            
            .welcome-icon {
                font-size: 2.5rem;
                margin-bottom: 16px;
            }
            
            .loading-bar {
                width: 180px;
                height: 5px;
            }
        }
        
        /* 全屏倒计时样式 - 翻页时钟风格 */
        .countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9998;
            transition: opacity 0.3s ease;
        }
        
        .countdown-overlay.show {
            display: flex !important;
            opacity: 1 !important;
            visibility: visible !important;
            background: #000 !important;
            z-index: 99999 !important;
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
        }
        
        .countdown-content {
            text-align: center;
            color: white;
            width: 75vw;
            height: 75vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: auto;
        }
        
        .countdown-date {
            font-size: 1.5rem;
            font-weight: 300;
            margin-bottom: 2rem;
            opacity: 0.8;
            letter-spacing: 1px;
        }
        
        .countdown-task-name {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 3rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            letter-spacing: 1px;
        }
        
        .countdown-clock {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .countdown-time {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .time-unit {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .time-label {
            font-size: 1rem;
            opacity: 0.7;
            margin-bottom: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 500;
        }
        
        .time-digits {
            display: flex;
            gap: 4px;
        }
        
        .time-digit {
            width: 90px;
            height: 120px;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            border: 3px solid #444;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4.5rem;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            color: white;
            position: relative;
            box-shadow: inset 0 3px 6px rgba(0,0,0,0.3), 0 4px 8px rgba(0,0,0,0.4);
            overflow: hidden;
        }
        
        .time-digit::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, transparent, #666, transparent);
            transform: translateY(-50%);
            z-index: 2;
            box-shadow: 0 0 4px rgba(255,255,255,0.1);
        }
        
        .digit-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .digit-current {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        }
        
        .digit-next {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(145deg, #2a2a2a, #1a1a1a);
            transform: translateY(100%);
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        }
        
        .digit-flip {
            animation: flipDigit 0.8s ease-in-out;
        }
        
        @keyframes flipDigit {
            0% {
                transform: rotateX(0deg);
            }
            100% {
                transform: rotateX(-180deg);
            }
        }
        
        .digit-flip .digit-current {
            transform: translateY(-100%);
            opacity: 0;
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        }
        
        .digit-flip .digit-next {
            transform: translateY(0);
            opacity: 1;
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
        }
        
        /* 添加阴影效果增强立体感 */
        .time-digit {
            perspective: 1000px;
        }
        
        .digit-container {
            transform-style: preserve-3d;
        }
        
        .digit-current, .digit-next {
            backface-visibility: hidden;
            transition: transform 0.8s ease-in-out, opacity 0.8s ease-in-out;
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        /* 篮球计分牌特有的边框效果 */
        .time-digit::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            pointer-events: none;
        }
        
        .time-separator {
            font-size: 4.5rem;
            font-weight: bold;
            color: white;
            opacity: 0.8;
            margin: 0 0.5rem;
        }
        
        .countdown-motto {
            font-size: 1.3rem;
            font-weight: 300;
            opacity: 0.7;
            letter-spacing: 1px;
            max-width: 800px;
            line-height: 1.6;
        }
        
        /* 移动端适配 */
        @media (max-width: 768px) {
            .countdown-content {
                width: 90vw;
                height: 80vh;
            }
            
            .countdown-date {
                font-size: 1.2rem;
                margin-bottom: 1.5rem;
            }
            
            .countdown-task-name {
                font-size: 1.5rem;
                margin-bottom: 2rem;
                color: white;
                font-weight: bold;
                text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            }
            
            .countdown-clock {
                gap: 0.8rem;
                margin-bottom: 2rem;
            }
            
            .time-digits {
                gap: 2px;
            }
            
            .time-digit {
                width: 50px;
                height: 70px;
                font-size: 2.5rem;
                border-radius: 8px;
                overflow: hidden;
            }
            
            .time-separator {
                font-size: 2.5rem;
            }
            
            .countdown-motto {
                font-size: 1.1rem;
                padding: 0 1rem;
                max-width: 90vw;
            }
            
            .time-label {
                font-size: 0.9rem;
                margin-bottom: 0.6rem;
            }
        }
        
        /* 小屏幕手机适配 */
        @media (max-width: 480px) {
            .countdown-content {
                width: 95vw;
                height: 85vh;
            }
            
            .countdown-date {
                font-size: 1rem;
                margin-bottom: 1rem;
            }
            
            .countdown-task-name {
                font-size: 1.3rem;
                margin-bottom: 1.5rem;
                color: white;
                font-weight: bold;
                text-shadow: 0 2px 4px rgba(0,0,0,0.5);
            }
            
            .countdown-clock {
                gap: 0.5rem;
                margin-bottom: 1.5rem;
            }
            
            .time-digits {
                gap: 1px;
            }
            
            .time-digit {
                width: 40px;
                height: 55px;
                font-size: 2rem;
                border-radius: 6px;
                overflow: hidden;
            }
            
            .time-separator {
                font-size: 2rem;
            }
            
            .countdown-motto {
                font-size: 1rem;
                padding: 0 0.5rem;
                max-width: 95vw;
            }
            
            .time-label {
                font-size: 0.8rem;
                margin-bottom: 0.4rem;
            }
            
            /* 超小屏幕统计卡片优化 */
            #stat-card-wrapper {
                max-width: 92vw;
                width: 92vw;
            }
            
            .stat-card {
                padding: 16px 12px;
                border-radius: 16px;
            }
            
            .stat-main-time {
                font-size: 0.9rem;
                margin-bottom: 10px;
            }
            
            .stat-main-time i {
                font-size: 1rem;
                margin-right: 6px;
            }
            
            /* 按钮容器超小屏幕优化 */
            .button-container {
                max-width: 92vw;
                width: 92vw;
                padding: 12px;
                border-radius: 16px;
            }
            
            .stat-reset-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 10px;
            }
            
            /* 统计行超小屏幕优化 */
            #stat-row {
                gap: 12px;
                margin: 16px auto 24px auto;
                max-width: 92vw;
            }
            
            /* 时间线项目超小屏幕优化 */
            .timeline-item {
                padding: 12px;
                margin-bottom: 10px;
                border-radius: 12px;
            }
            
            .timeline-item .time {
                font-size: 0.9rem;
                margin-bottom: 6px;
            }
            
            .timeline-item .activity {
                font-size: 1rem;
                margin-bottom: 10px;
            }
            
            .timeline-item .task-controls {
                gap: 6px;
            }
            
            .timeline-item .btn {
                padding: 6px 10px;
                font-size: 0.8rem;
                border-radius: 6px;
            }
        }
        
        /* 励志语录编辑样式 */
        .motto-quote:focus, .motto-author:focus {
            background-color: rgba(38, 208, 206, 0.1);
            outline: 2px solid #26d0ce;
            outline-offset: 2px;
        }
        
        .motto-quote:hover, .motto-author:hover {
            background-color: rgba(38, 208, 206, 0.05);
        }
        

        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 25px 20px;
            color: white;
            margin-bottom: 20px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-width: 1000px;
            margin-left: auto;
            margin-right: auto;
        }
        
        /* 页面标题移动端优化 */
        @media (max-width: 768px) {
            header {
                padding: 20px 15px;
                margin-bottom: 16px;
                border-radius: 12px;
                max-width: 95vw;
            }
            
            h1 {
                font-size: 1.8rem;
                margin-bottom: 10px;
            }
            
            .subtitle {
                font-size: 0.9rem;
                max-width: 90vw;
            }
        }
        
        @media (max-width: 480px) {
            header {
                padding: 16px 12px;
                margin-bottom: 12px;
                border-radius: 10px;
                max-width: 92vw;
            }
            
            h1 {
                font-size: 1.6rem;
                margin-bottom: 8px;
            }
            
            .subtitle {
                font-size: 0.85rem;
                max-width: 88vw;
            }
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 12px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }
        
        .principles {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin: 20px 0;
            justify-content: center;
        }
        
        /* 移动端原则区域优化 */
        @media (max-width: 768px) {
            .principles {
                gap: 16px;
                margin: 16px 0;
            }
        }
        
        @media (max-width: 480px) {
            .principles {
                gap: 12px;
                margin: 12px 0;
            }
        }
        
        .principle-card {
            background: rgba(255, 255, 255, 0.85);
            border-radius: 12px;
            padding: 16px;
            width: 260px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            text-align: center;
        }
        
        /* 移动端原则卡片优化 */
        @media (max-width: 768px) {
            .principle-card {
                width: 100%;
                max-width: 300px;
                padding: 14px;
                border-radius: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .principle-card {
                padding: 12px;
                border-radius: 8px;
            }
        }
        
        .principle-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }
        
        .principle-card i {
            font-size: 2.5rem;
            margin-bottom: 15px;
            color: #1a2980;
        }
        
        /* 移动端原则卡片图标优化 */
        @media (max-width: 768px) {
            .principle-card i {
                font-size: 2.2rem;
                margin-bottom: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .principle-card i {
                font-size: 2rem;
                margin-bottom: 10px;
            }
        }
        
        .schedule-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            margin-bottom: 40px;
        }
        
        /* 移动端时间表容器优化 */
        @media (max-width: 768px) {
            .schedule-container {
                flex-direction: column;
                gap: 20px;
                margin-bottom: 30px;
            }
        }
        
        @media (max-width: 480px) {
            .schedule-container {
                gap: 16px;
                margin-bottom: 24px;
            }
        }
        
        .timeline {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* 移动端时间线优化 */
        @media (max-width: 768px) {
            .timeline {
                min-width: 0;
                width: 100%;
                border-radius: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .timeline {
                border-radius: 10px;
            }
        }
        
        .timeline-header {
            background: linear-gradient(to right, #1a2980, #26d0ce);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }
        
        /* 移动端时间线头部优化 */
        @media (max-width: 768px) {
            .timeline-header {
                padding: 20px 16px;
            }
        }
        
        @media (max-width: 480px) {
            .timeline-header {
                padding: 16px 12px;
            }
        }
        
        .timeline-items {
            padding: 25px 20px;
        }
        
        /* 移动端时间线项目容器优化 */
        @media (max-width: 768px) {
            .timeline-items {
                padding: 20px 16px;
            }
        }
        
        @media (max-width: 480px) {
            .timeline-items {
                padding: 16px 12px;
            }
        }
        
        .timeline-item {
            display: flex;
            padding: 20px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
            transition: all 0.3s;
            position: relative;
        }
        
        /* 移动端时间线项目优化 */
        @media (max-width: 768px) {
            .timeline-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 16px 0;
            }
        }
        
        @media (max-width: 480px) {
            .timeline-item {
                padding: 12px 0;
            }
        }
        
        .timeline-item:hover {
            background-color: #f9f9ff;
            transform: scale(1.01);
        }
        
        .timeline-item:last-child {
            border-bottom: none;
        }
        
        .time {
            font-weight: bold;
            min-width: 130px;
            color: #1a2980;
            font-size: 1.1rem;
        }
        
        /* 移动端时间显示优化 */
        @media (max-width: 768px) {
            .time {
                min-width: auto;
                margin-bottom: 8px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .time {
                margin-bottom: 6px;
                font-size: 0.9rem;
            }
        }
        
        .activity {
            flex-grow: 1;
            padding: 0 20px;
        }
        
        /* 移动端活动区域优化 */
        @media (max-width: 768px) {
            .activity {
                padding: 0;
                width: 100%;
            }
        }
        
        .activity-title {
            font-weight: 600;
            font-size: 1.15rem;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
        }
        
        /* 移动端活动标题优化 */
        @media (max-width: 768px) {
            .activity-title {
                font-size: 1.1rem;
                margin-bottom: 6px;
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .activity-title {
                font-size: 1rem;
                margin-bottom: 4px;
            }
        }
        
        .duration {
            background: #eef7ff;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.9rem;
            color: #1a2980;
            font-weight: 500;
            display: inline-block;
            margin-left: 10px;
        }
        
        /* 移动端时长标签优化 */
        @media (max-width: 768px) {
            .duration {
                padding: 4px 10px;
                border-radius: 16px;
                font-size: 0.85rem;
                margin-left: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .duration {
                padding: 3px 8px;
                border-radius: 12px;
                font-size: 0.8rem;
                margin-left: 6px;
            }
        }
        
        .subject {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            color: white;
            font-weight: 500;
            font-size: 0.85rem;
            margin-top: 8px;
            background: linear-gradient(to right, #6a11cb, #2575fc);
        }
        
        /* 移动端科目标签优化 */
        @media (max-width: 768px) {
            .subject {
                padding: 3px 10px;
                border-radius: 16px;
                font-size: 0.8rem;
                margin-top: 6px;
            }
        }
        
        @media (max-width: 480px) {
            .subject {
                padding: 2px 8px;
                border-radius: 12px;
                font-size: 0.75rem;
                margin-top: 4px;
            }
        }
        
        .math { background: linear-gradient(to right, #ff416c, #ff4b2b); }
        .english { background: linear-gradient(to right, #2193b0, #6dd5ed); }
        .major { background: linear-gradient(to right, #38ef7d, #11998e); }
        .politics { background: linear-gradient(to right, #8e2de2, #4a00e0); }
        .rest { background: linear-gradient(to right, #ff9a9e, #fad0c4); color: #333; }
        .meal { background: linear-gradient(to right, #ff9a9e, #fecfef); color: #333; }
        .review { background: linear-gradient(to right, #00c6ff, #0072ff); color: white; }
        
        /* 移动端隐藏科目标签和任务描述 */
        @media (max-width: 768px) {
            .subject-label {
                display: none !important;
            }
            
            .task-description {
                display: none !important;
            }
        }
        
        /* 按钮分隔线 */
        .button-divider {
            width: 80%;
            height: 1px;
            background: linear-gradient(90deg, transparent, #e0e0e0, transparent);
            margin: 16px auto;
        }
        
        /* 卡片隐藏/显示动画 */
        .main-card {
            transition: all 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            opacity: 1;
            transform: translateY(0) scale(1);
            max-height: 2000px;
            overflow: hidden;
            filter: blur(0px);
            margin-bottom: 20px;
        }
        
        .main-card.hidden {
            opacity: 0;
            transform: translateY(-30px) scale(0.95);
            max-height: 0;
            margin: 0;
            padding: 0;
            filter: blur(2px);
            pointer-events: none;
            flex: 0 !important;
            width: 0 !important;
            min-width: 0 !important;
            max-width: 0 !important;
        }
        
        /* 当有卡片隐藏时，调整主卡片行的布局 */
        #main-cards-row:has(.main-card.hidden) {
            gap: 0 !important;
        }
        
        #main-cards-row:has(.main-card.hidden) .main-card:not(.hidden) {
            flex: 1 !important;
            max-width: 100% !important;
        }
        
        /* 当所有卡片都隐藏时，隐藏整个主卡片行 */
        #main-cards-row:has(.main-card.hidden):has(.main-card:not(.hidden)) {
            /* 当有隐藏的卡片但没有可见卡片时 */
        }
        
        #main-cards-row.all-hidden {
            max-height: 0 !important;
            margin: 0 !important;
            padding: 0 !important;
            overflow: hidden !important;
            opacity: 0 !important;
            transform: translateY(-30px) scale(0.95) !important;
            filter: blur(2px) !important;
        }
        
        .card-toggle-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 25px;
            background: linear-gradient(135deg, #26d0ce, #1a2980);
            color: white;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(38, 208, 206, 0.2);
            width: 100%;
            justify-content: center;
        }
        
        .card-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(38, 208, 206, 0.3);
        }
        
        .card-toggle-btn:active {
            transform: translateY(0);
        }
        
        .card-toggle-btn.show {
            background: linear-gradient(135deg, #ff9800, #f57c00);
        }
        
        .card-toggle-btn.show[data-target="motto"] {
            background: linear-gradient(135deg, #1a2980, #26d0ce);
        }
        
        .card-toggle-btn.show i {
            transform: rotate(180deg);
        }
        
        .card-toggle-btn i {
            transition: transform 0.3s ease;
        }
        

        
        .notes {
            flex: 1;
            min-width: 300px;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
        }
        
        /* 移动端笔记区域优化 */
        @media (max-width: 768px) {
            .notes {
                min-width: 0;
                width: 100%;
                padding: 24px 20px;
                border-radius: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .notes {
                padding: 20px 16px;
                border-radius: 10px;
            }
        }
        
        .notes h2 {
            color: #1a2980;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            text-align: center;
        }
        
        /* 移动端笔记标题优化 */
        @media (max-width: 768px) {
            .notes h2 {
                margin-bottom: 20px;
                padding-bottom: 12px;
                font-size: 1.3rem;
            }
        }
        
        @media (max-width: 480px) {
            .notes h2 {
                margin-bottom: 16px;
                padding-bottom: 10px;
                font-size: 1.2rem;
            }
        }
        
        .tips {
            margin-top: 30px;
        }
        
        .tip {
            background: #f8fbff;
            padding: 20px;
            border-left: 4px solid #26d0ce;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
            transition: all 0.3s;
        }
        
        /* 移动端提示区域优化 */
        @media (max-width: 768px) {
            .tip {
                padding: 16px;
                margin-bottom: 16px;
                border-radius: 0 6px 6px 0;
            }
        }
        
        @media (max-width: 480px) {
            .tip {
                padding: 12px;
                margin-bottom: 12px;
                border-radius: 0 4px 4px 0;
            }
        }
        
        .tip:hover {
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
        }
        
        .tip h3 {
            color: #1a2980;
            margin-bottom: 12px;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
        }
        
        /* 移动端提示标题优化 */
        @media (max-width: 768px) {
            .tip h3 {
                font-size: 1.1rem;
                margin-bottom: 10px;
            }
        }
        
        @media (max-width: 480px) {
            .tip h3 {
                font-size: 1rem;
                margin-bottom: 8px;
            }
        }
        
        .tip h3 i {
            margin-right: 10px;
            color: #ff4b2b;
        }
        
        /* 移动端提示图标优化 */
        @media (max-width: 768px) {
            .tip h3 i {
                margin-right: 8px;
            }
        }
        
        @media (max-width: 480px) {
            .tip h3 i {
                margin-right: 6px;
            }
        }
        
        .motivation {
            text-align: center;
            background: linear-gradient(to right, rgba(255,255,255,0.9), rgba(255,255,255,0.7));
            border-radius: 15px;
            padding: 40px 30px;
            margin: 40px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        /* 移动端激励区域优化 */
        @media (max-width: 768px) {
            .motivation {
                padding: 30px 20px;
                margin: 30px 0;
                border-radius: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .motivation {
                padding: 24px 16px;
                margin: 24px 0;
                border-radius: 10px;
            }
        }
        
        .motivation i {
            font-size: 3.5rem;
            color: #ff4b2b;
            margin-bottom: 25px;
        }
        
        /* 移动端激励图标优化 */
        @media (max-width: 768px) {
            .motivation i {
                font-size: 3rem;
                margin-bottom: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .motivation i {
                font-size: 2.5rem;
                margin-bottom: 16px;
            }
        }
        
        .quote {
            font-style: italic;
            font-size: 1.6rem;
            color: #1a2980;
            margin: 25px 0;
            line-height: 1.8;
            font-weight: 500;
        }
        
        /* 移动端引用文字优化 */
        @media (max-width: 768px) {
            .quote {
                font-size: 1.4rem;
                margin: 20px 0;
                line-height: 1.6;
            }
        }
        
        @media (max-width: 480px) {
            .quote {
                font-size: 1.2rem;
                margin: 16px 0;
                line-height: 1.5;
            }
        }
        
        .author {
            font-weight: bold;
            color: #4a00e0;
            font-size: 1.1rem;
        }
        
        /* 移动端作者信息优化 */
        @media (max-width: 768px) {
            .author {
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            .author {
                font-size: 0.9rem;
            }
        }
        
        footer {
            text-align: center;
            color: white;
            padding: 25px;
            margin-top: 20px;
            opacity: 0.9;
            font-size: 1.1rem;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }
        
        /* 移动端页脚优化 */
        @media (max-width: 768px) {
            footer {
                padding: 20px 16px;
                margin-top: 16px;
                font-size: 1rem;
            }
        }
        
        @media (max-width: 480px) {
            footer {
                padding: 16px 12px;
                margin-top: 12px;
                font-size: 0.9rem;
            }
        }
        
        .highlight {
            background: linear-gradient(120deg, rgba(255,215,0,0.3), rgba(255,215,0,0.1));
            padding: 3px 8px;
            border-radius: 4px;
            font-weight: 600;
        }
        
        .tomato {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #ff4b2b;
            border-radius: 50%;
            margin-right: 8px;
            position: relative;
            top: 2px;
        }
        
        .english-highlight {
            animation: pulse-english 2s infinite;
            position: relative;
        }
        
        .update-badge {
            background: #FFD700;
            color: #8B4513;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
            display: inline-block;
        }
        
        .task-controls {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        /* 移动端任务控制按钮优化 */
        @media (max-width: 768px) {
            .task-controls {
                gap: 8px;
                margin-top: 12px;
                flex-wrap: wrap;
            }
        }
        
        @media (max-width: 480px) {
            .task-controls {
                gap: 6px;
                margin-top: 10px;
            }
        }
        
        .btn {
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            border: none;
            font-weight: 500;
            transition: all 0.3s;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        /* 移动端按钮优化 */
        @media (max-width: 768px) {
            .btn {
                padding: 6px 12px;
                border-radius: 16px;
                font-size: 0.85rem;
                min-height: 36px;
            }
        }
        
        @media (max-width: 480px) {
            .btn {
                padding: 5px 10px;
                border-radius: 12px;
                font-size: 0.8rem;
                min-height: 32px;
            }
        }
        
        .btn-start {
            background-color: #26d0ce;
            color: white;
        }
        
        .btn-start:hover {
            background-color: #1aa09e;
        }
        
        .btn-complete {
            background-color: #eef7ff;
            color: #1a2980;
        }
        
        .btn-complete:hover {
            background-color: #d9eafd;
        }
        
        .btn-pause {
            background-color: #ffc107;
            color: white;
        }
        
        .btn-pause:hover {
            background-color: #e0a800;
        }
        
        .btn-resume {
            background-color: #28a745;
            color: white;
        }
        
        .btn-resume:hover {
            background-color: #218838;
        }
        
        .timer {
            font-size: 1.1rem;
            margin-top: 10px;
            color: #1a2980;
            font-weight: bold;
            min-height: 24px;
        }
        
        /* 移动端计时器优化 */
        @media (max-width: 768px) {
            .timer {
                font-size: 1rem;
                margin-top: 8px;
                min-height: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .timer {
                font-size: 0.9rem;
                margin-top: 6px;
                min-height: 18px;
            }
        }
        
        .completed .activity-title,
        .completed p {
            text-decoration: line-through;
            color: #a0a0a0;
        }
        
        .completed .btn-complete {
            background-color: #28a745;
            color: white;
        }
        
        .active-task {
            background-color: #f0f7ff !important;
            border-left: 4px solid #26d0ce;
            transform: scale(1.02);
            z-index: 10;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        
        .timer-running {
            animation: pulse 1.5s infinite;
        }
        
        .timer-completed {
            color: #28a745;
            font-weight: bold;
        }
        
        /* 编辑模式样式 */
        .edit-mode .timeline-item {
            cursor: grab;
            transition: all 0.3s ease;
        }
        
        /* 移动端编辑模式优化 */
        @media (max-width: 768px) {
            .edit-mode .timeline-item {
                cursor: default;
            }
        }
        
        .edit-mode .timeline-item:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .edit-mode .timeline-item:active {
            cursor: grabbing;
        }
        
        .edit-mode .timeline-item.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }
        
        /* 编辑模式移动端优化 */
        @media (max-width: 768px) {
            .edit-mode .timeline-item {
                cursor: default;
            }
            
            .edit-mode .timeline-item:hover {
                transform: none;
            }
            
            .edit-mode .timeline-item:active {
                cursor: default;
            }
            
            .edit-mode .timeline-item.dragging {
                transform: none;
            }
        }
        
        .edit-mode .timeline-item.drag-over {
            border-top: 3px solid #ff9800;
            margin-top: 10px;
        }
        
        .edit-mode .timeline-item.drag-over::before {
            content: "↓ 放置位置";
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff9800;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            z-index: 1000;
        }
        
        .edit-mode .timeline-item.fixed {
            cursor: not-allowed;
            opacity: 0.7;
        }
        
        .edit-mode .timeline-item.fixed:hover {
            transform: none;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes pulse-english {
            0% { box-shadow: 0 0 0 0 rgba(33, 147, 176, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(33, 147, 176, 0); }
            100% { box-shadow: 0 0 0 0 rgba(33, 147, 176, 0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 75, 43, 0.7); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 10px rgba(255, 75, 43, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255, 75, 43, 0); }
        }
        
        @media (max-width: 768px) {
            .schedule-container {
                flex-direction: column;
            }
            
            h1 {
                font-size: 2.2rem;
            }
            
            .principle-card {
                width: 100%;
            }
            
            .quote {
                font-size: 1.3rem;
            }
            
            .timeline-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time {
                margin-bottom: 10px;
            }
            
            .activity {
                padding: 0;
            }
            
            .task-controls {
                margin-top: 15px;
            }
            
            /* 统计卡片移动端优化 */
            #stat-card-wrapper {
                min-width: 0;
                max-width: 95vw;
                width: 95vw;
            }
            
            .stat-card {
                min-width: 0;
                padding: 20px 16px;
                border-radius: 20px;
            }
            
            .stat-main-time {
                font-size: 1rem;
                margin-bottom: 12px;
            }
            
            .stat-main-time i {
                font-size: 1.1rem;
                margin-right: 8px;
            }
            
            /* 按钮容器移动端优化 */
            .button-container {
                min-width: 0;
                max-width: 95vw;
                width: 95vw;
                padding: 16px;
                border-radius: 20px;
            }
            
            .stat-reset-btn {
                padding: 10px 16px;
                font-size: 0.9rem;
                border-radius: 12px;
            }
            
            /* 统计行布局优化 */
            #stat-row {
                flex-direction: column;
                gap: 16px;
                margin: 20px auto 32px auto;
                max-width: 95vw;
            }
            
            /* 时间线项目移动端优化 */
            .timeline-item {
                padding: 16px;
                margin-bottom: 12px;
                border-radius: 16px;
            }
            
            .timeline-item .time {
                font-size: 1rem;
                margin-bottom: 8px;
            }
            
            .timeline-item .activity {
                font-size: 1.1rem;
                margin-bottom: 12px;
            }
            
            .timeline-item .task-controls {
                gap: 8px;
            }
            
            .timeline-item .btn {
                padding: 8px 12px;
                font-size: 0.85rem;
                border-radius: 8px;
            }
        }
        #calendar-module-wrapper {
            display: flex;
            justify-content: center;
            margin: 30px auto 20px auto;
        }
        
        /* 移动端日历模块包装器优化 */
        @media (max-width: 768px) {
            #calendar-module-wrapper {
                margin: 24px auto 16px auto;
            }
        }
        
        @media (max-width: 480px) {
            #calendar-module-wrapper {
                margin: 20px auto 12px auto;
            }
        }
        #calendar-view {
            background: rgba(255,255,255,0.95);
            border-radius: 22px;
            box-shadow: 0 8px 32px rgba(26,41,128,0.13);
            padding: 32px 32px 24px 32px;
            min-width: 370px;
            max-width: 440px;
            margin: 0 auto;
            border: 1.5px solid #e0e7ef;
        }
        #calendar-view .calendar-title {
            text-align: center;
            font-weight: bold;
            font-size: 1.7rem;
            margin-bottom: 16px;
            color: #1a2980;
            letter-spacing: 1px;
        }
        #calendar-view .calendar-header-btn {
            margin: 0 18px;
            padding: 6px 18px;
            border-radius: 10px;
            border: 1.5px solid #b5c6e0;
            background: #f7fafc;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            color: #1a2980;
            box-shadow: 0 2px 8px rgba(26,41,128,0.07);
            transition: background 0.2s, color 0.2s;
        }
        #calendar-view .calendar-header-btn:hover {
            background: #e0e7ef;
            color: #11998e;
        }
        #calendar-view .calendar-week-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            margin-bottom: 8px;
        }
        #calendar-view .calendar-week-row div {
            text-align: center;
            font-weight: bold;
            color: #1a2980;
            font-size: 1.08rem;
            letter-spacing: 1px;
            padding-bottom: 2px;
        }
        #calendar-view .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 6px;
        }
        #calendar-view .calendar-cell {
            text-align: center;
            padding: 13px 0 8px 0;
            border-radius: 16px;
            font-size: 1.18rem;
            font-weight: 600;
            color: #1a2980;
            background: none;
            position: relative;
            cursor: pointer;
            transition: background 0.18s, color 0.18s, box-shadow 0.18s;
            min-width: 40px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-sizing: border-box;
            overflow: visible;
        }
        #calendar-view .calendar-cell.selected {
            background: linear-gradient(90deg,#1a2980,#26d0ce);
            color: #fff;
            box-shadow: 0 2px 12px rgba(26,41,128,0.18);
        }
        #calendar-view .calendar-cell.today:not(.selected) {
            background: linear-gradient(90deg,#e0e7ef,#b5c6e0);
            color: #1a2980;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(26,41,128,0.10);
        }
        #calendar-view .calendar-cell .calendar-badge {
            position: absolute;
            right: 4px;
            top: 4px;
            background: #FFD700;
            color: #8B4513;
            font-size: 0.75rem;
            border-radius: 50%;
            padding: 1px 4px 1px 4px;
            font-weight: bold;
            box-shadow: 0 1px 4px rgba(255,215,0,0.13);
            border: 1px solid #fff;
            min-width: 16px;
            min-height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1;
            line-height: 1;
            text-align: center;
            overflow: hidden;
        }
        @media (max-width: 600px) {
            #calendar-view {
                min-width: 0;
                max-width: 100%;
                width: 100%;
                padding: 20px 16px 16px 16px;
                box-sizing: border-box;
            }
            #calendar-view .calendar-grid {
                gap: 4px;
            }
            #calendar-view .calendar-title {
                font-size: 1.5rem;
                margin-bottom: 14px;
            }
            #calendar-view .calendar-header-btn {
                margin: 0 12px;
                padding: 5px 14px;
                font-size: 1.1rem;
            }
            #calendar-view .calendar-week-row div {
                font-size: 1rem;
            }
            #calendar-view .calendar-cell {
                padding: 6px 0 3px 0;
                font-size: 0.95rem;
                min-width: 28px;
                min-height: 28px;
            }
            #calendar-view .calendar-cell .calendar-badge {
                right: 2px;
                top: 2px;
                font-size: 0.65rem;
                padding: 1px 2px 1px 2px;
                min-width: 12px;
                min-height: 12px;
                line-height: 1;
                text-align: center;
                overflow: hidden;
            }
        }
        
        @media (max-width: 480px) {
            #calendar-view {
                max-width: 100%;
                width: 100%;
                padding: 16px 12px 12px 12px;
                box-sizing: border-box;
            }
            #calendar-view .calendar-grid {
                gap: 1px;
            }
            #calendar-view .calendar-title {
                font-size: 1.3rem;
                margin-bottom: 12px;
            }
            #calendar-view .calendar-header-btn {
                margin: 0 8px;
                padding: 4px 10px;
                font-size: 1rem;
            }
            #calendar-view .calendar-week-row div {
                font-size: 0.9rem;
            }
            #calendar-view .calendar-cell {
                padding: 3px 0 1px 0;
                font-size: 0.8rem;
                min-width: 20px;
                min-height: 20px;
            }
            #calendar-view .calendar-cell .calendar-badge {
                right: 1px;
                top: 1px;
                font-size: 0.6rem;
                padding: 1px 1px 1px 1px;
                min-width: 10px;
                min-height: 10px;
                line-height: 1;
                text-align: center;
                overflow: hidden;
            }
        }
        #calendar-statistics-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 48px;
            margin: 40px auto 32px auto;
            max-width: 1100px;
            width: 100%;
        }
        
        /* 移动端日历统计行优化 */
        @media (max-width: 768px) {
            #calendar-statistics-row {
                flex-direction: column;
                align-items: center;
                gap: 24px;
                margin: 24px auto 24px auto;
            }
        }
        
        @media (max-width: 480px) {
            #calendar-statistics-row {
                gap: 20px;
                margin: 20px auto 20px auto;
            }
        }

        #stat-card-wrapper {
            display: flex;
            justify-content: center;
            align-items: stretch;
            flex: 1;
            min-width: 480px;
            max-width: 700px;
            min-height: 200px;
            opacity: 1;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* 移动端统计卡片包装器优化 */
        @media (max-width: 768px) {
            #stat-card-wrapper {
                min-width: 0;
                max-width: 95vw;
                width: 95vw;
                min-height: auto;
            }
        }
        
        @media (max-width: 480px) {
            #stat-card-wrapper {
                max-width: 92vw;
                width: 92vw;
            }
        }
        
        #stat-card-wrapper:empty {
            opacity: 0;
        }
        .stat-card {
            background: #f6fafd;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(26,41,128,0.10);
            padding: 28px 40px 28px 40px;
            min-width: 400px;
            max-width: 600px;
            width: 100%;
            height: 100%;
            flex: 1;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: center;
            gap: 20px;
        }
        
        /* 移动端统计卡片优化 */
        @media (max-width: 768px) {
            .stat-card {
                min-width: 0;
                max-width: 95vw;
                width: 95vw;
                padding: 24px 20px;
                border-radius: 20px;
                gap: 16px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-card {
                max-width: 92vw;
                width: 92vw;
                padding: 20px 16px;
                border-radius: 16px;
                gap: 14px;
            }
        }
        .stat-main-time {
            font-size: 1.6rem;
            font-weight: 900;
            color: #1a2980;
            letter-spacing: 1px;
            width: 100%;
        }
        
        /* 移动端统计主时间优化 */
        @media (max-width: 768px) {
            .stat-main-time {
                font-size: 1.4rem;
            }
        }
        
        @media (max-width: 480px) {
            .stat-main-time {
                font-size: 1.2rem;
            }
        }
        .stat-completed-list {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
        }
        
        /* 移动端统计完成列表优化 */
        @media (max-width: 768px) {
            .stat-completed-list {
                gap: 12px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-completed-list {
                gap: 8px;
            }
        }
        .stat-completed-item {
            background: #e0f7fa;
            color: #11998e;
            font-weight: bold;
            font-size: 1.08rem;
            border-radius: 16px;
            padding: 10px 20px;
            display: flex;
            align-items: center;
            gap: 8px;
            min-width: 90px;
        }
        
        /* 移动端统计完成项目优化 */
        @media (max-width: 768px) {
            .stat-completed-item {
                font-size: 1rem;
                border-radius: 12px;
                padding: 8px 16px;
                min-width: 80px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-completed-item {
                font-size: 0.9rem;
                border-radius: 10px;
                padding: 6px 12px;
                min-width: 70px;
            }
        }
        .stat-completed-dot {
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            vertical-align: middle;
        }
        
        /* 移动端统计完成点优化 */
        @media (max-width: 768px) {
            .stat-completed-dot {
                width: 14px;
                height: 14px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-completed-dot {
                width: 12px;
                height: 12px;
            }
        }
        .stat-reset-btn {
            background: #1a2980;
            color: #fff;
            border: none;
            border-radius: 16px;
            padding: 12px 24px;
            font-weight: bold;
            font-size: 1.08rem;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(26,41,128,0.13);
            transition: all 0.2s;
            width: 100%;
            min-width: 160px;
        }
        
        /* 移动端统计重置按钮优化 */
        @media (max-width: 768px) {
            .stat-reset-btn {
                border-radius: 12px;
                padding: 10px 20px;
                font-size: 1rem;
                min-width: 140px;
            }
        }
        
        @media (max-width: 480px) {
            .stat-reset-btn {
                border-radius: 10px;
                padding: 8px 16px;
                font-size: 0.9rem;
                min-width: 120px;
            }
        }
        .stat-reset-btn:hover {
            background: #26d0ce;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26,41,128,0.2);
        }
        
        .stat-reset-btn[style*="background:#ff9800"]:hover {
            background: #f57c00 !important;
        }
        
        .button-container {
            display: flex;
            flex-direction: column;
            gap: 16px;
            min-width: 240px;
            max-width: 280px;
            flex-shrink: 0;
            background: #f6fafd;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(26,41,128,0.10);
            padding: 32px 28px 32px 28px;
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
        }
        
        /* 移动端按钮容器优化 */
        @media (max-width: 768px) {
            .button-container {
                min-width: 0;
                max-width: 95vw;
                width: 95vw;
                padding: 28px 24px;
                border-radius: 20px;
            }
            
            .button-divider {
                width: 90%;
                margin: 20px auto;
            }
        }
        
        @media (max-width: 480px) {
            .button-container {
                max-width: 92vw;
                width: 92vw;
                padding: 24px 20px;
                border-radius: 16px;
            }
            
            .button-divider {
                width: 95%;
                margin: 18px auto;
            }
        }
        @media (max-width: 900px) {
            #stat-row {
                flex-direction: column;
                align-items: center;
                gap: 24px;
            }
            #stat-card-wrapper {
                max-width: 98vw;
                min-width: 0;
                flex: none;
            }
            .stat-card {
                min-width: 0;
                max-width: 98vw;
                width: 98vw;
                height: auto;
                padding: 24px 4vw 24px 4vw;
                flex-direction: column;
                align-items: flex-start;
                gap: 18px;
            }
            .stat-main-time {
                font-size: 1.3rem;
            }
            .button-container {
                min-width: 240px;
                max-width: 340px;
                width: 100%;
                height: auto;
                padding: 28px 24px 28px 24px;
            }
        }
        /* 日历和励志语录模块的移动端优化 */
        @media (max-width: 900px) {
            #main-cards-row {
                flex-direction: column !important;
                align-items: center !important;
                gap: 24px !important;
                margin-top: 18px !important;
            }
            .main-card {
                min-width: 0 !important;
                max-width: 98vw !important;
                width: 98vw !important;
                padding: 32px 6vw 32px 6vw !important;
                min-height: auto !important;
            }
            .main-card-title, .main-card-calendar-title {
                font-size: 1.8rem !important;
                margin-bottom: 18px !important;
            }
            .main-card-title i, .main-card-calendar-title i {
                font-size: 1.9rem !important;
                margin-right: 12px !important;
            }
            .main-card-divider {
                margin-bottom: 24px !important;
            }
            .motto-quote {
                font-size: 1.2rem !important;
                line-height: 1.6 !important;
                margin-bottom: 18px !important;
            }
            .motto-author {
                font-size: 1rem !important;
            }
            .motto-item {
                margin-bottom: 32px !important;
            }
            .motto-item:last-child {
                margin-bottom: 0 !important;
            }
        }
        /* 小屏幕设备优化 */
        @media (max-width: 600px) {
            #main-cards-row {
                gap: 20px !important;
                margin-top: 16px !important;
            }
            .main-card {
                max-width: 95vw !important;
                width: 95vw !important;
                padding: 24px 4vw 24px 4vw !important;
            }
            .main-card-title, .main-card-calendar-title {
                font-size: 1.6rem !important;
                margin-bottom: 16px !important;
            }
            .main-card-title i, .main-card-calendar-title i {
                font-size: 1.7rem !important;
                margin-right: 10px !important;
            }
            .main-card-divider {
                margin-bottom: 20px !important;
            }
            .motto-quote {
                font-size: 1.1rem !important;
                line-height: 1.5 !important;
                margin-bottom: 16px !important;
            }
            .motto-author {
                font-size: 0.95rem !important;
            }
            .motto-item {
                margin-bottom: 28px !important;
            }
        }
        
        /* 超小屏幕设备优化 */
        @media (max-width: 480px) {
            #main-cards-row {
                gap: 16px !important;
                margin-top: 12px !important;
            }
            .main-card {
                max-width: 92vw !important;
                width: 92vw !important;
                padding: 20px 3vw 20px 3vw !important;
            }
            .main-card-title, .main-card-calendar-title {
                font-size: 1.4rem !important;
                margin-bottom: 14px !important;
            }
            .main-card-title i, .main-card-calendar-title i {
                font-size: 1.5rem !important;
                margin-right: 8px !important;
            }
            .main-card-divider {
                margin-bottom: 18px !important;
            }
            .motto-quote {
                font-size: 1rem !important;
                line-height: 1.4 !important;
                margin-bottom: 14px !important;
            }
            .motto-author {
                font-size: 0.9rem !important;
            }
            .motto-item {
                margin-bottom: 24px !important;
            }
        }
        

        /* 卡片式并排布局 */
        #main-cards-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: stretch;
            gap: 48px;
            margin: 40px auto 0 auto;
            max-width: 1400px;
            width: 100%;
        }
        
        /* 移动端主卡片行优化 */
        @media (max-width: 768px) {
            #main-cards-row {
                flex-direction: column !important;
                align-items: center !important;
                gap: 24px !important;
                margin: 24px auto 0 auto !important;
            }
        }
        
        @media (max-width: 480px) {
            #main-cards-row {
                gap: 20px !important;
                margin: 20px auto 0 auto !important;
            }
        }
        .main-card {
            background: #f6fafd;
            border-radius: 28px;
            box-shadow: 0 6px 32px rgba(26,41,128,0.10);
            padding: 48px 56px 48px 56px;
            min-width: 480px;
            max-width: 700px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            justify-content: flex-start;
            min-height: 540px;
        }
        
        /* 移动端主卡片优化 */
        @media (max-width: 768px) {
            .main-card {
                min-width: 0 !important;
                max-width: 95vw !important;
                width: 95vw !important;
                padding: 32px 24px !important;
                border-radius: 20px !important;
                min-height: auto !important;
            }
        }
        
        @media (max-width: 480px) {
            .main-card {
                max-width: 92vw !important;
                width: 92vw !important;
                padding: 24px 20px !important;
                border-radius: 16px !important;
            }
        }
        .main-card-title, .main-card-calendar-title {
            display: flex;
            align-items: center;
            font-size: 2.35rem;
            font-weight: 900;
            color: #1a2980;
            margin-bottom: 22px;
            letter-spacing: 1px;
        }
        
        /* 移动端主卡片标题优化 */
        @media (max-width: 768px) {
            .main-card-title, .main-card-calendar-title {
                font-size: 2rem !important;
                margin-bottom: 18px !important;
            }
        }
        
        @media (max-width: 480px) {
            .main-card-title, .main-card-calendar-title {
                font-size: 1.8rem !important;
                margin-bottom: 16px !important;
            }
        }
        .main-card-title i, .main-card-calendar-title i {
            font-size: 2.4rem;
            margin-right: 16px;
            color: #3ed2cc;
        }
        
        .edit-hint {
            font-size: 0.8rem;
            color: #666;
            margin-left: 10px;
            font-weight: normal;
        }
        
        .main-card-calendar-inner {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .motto-list {
            width: 100%;
        }
        
        /* 移动端主卡片标题图标优化 */
        @media (max-width: 768px) {
            .main-card-title i, .main-card-calendar-title i {
                font-size: 2.1rem !important;
                margin-right: 12px !important;
            }
        }
        
        @media (max-width: 480px) {
            .main-card-title i, .main-card-calendar-title i {
                font-size: 1.9rem !important;
                margin-right: 10px !important;
            }
        }
        .main-card-divider {
            width: 100%;
            height: 2px;
            background: linear-gradient(to right, #e0e7ef, #f6fafd 80%);
            margin: 0 0 32px 0;
            border: none;
        }
        
        /* 移动端主卡片分割线优化 */
        @media (max-width: 768px) {
            .main-card-divider {
                margin: 0 0 24px 0 !important;
            }
        }
        
        @media (max-width: 480px) {
            .main-card-divider {
                margin: 0 0 20px 0 !important;
            }
        }
        .motto-list {
            width: 100%;
        }
        
        .motto-item {
            margin-bottom: 40px;
        }
        
        /* 移动端励志语录项目优化 */
        @media (max-width: 768px) {
            .motto-item {
                margin-bottom: 32px !important;
            }
        }
        
        @media (max-width: 480px) {
            .motto-item {
                margin-bottom: 28px !important;
            }
        }
        .motto-item:last-child {
            margin-bottom: 0;
        }
        .motto-quote {
            font-size: 1.45rem;
            color: #1a2980;
            font-weight: 700;
            line-height: 2.1;
            margin-bottom: 22px;
            text-align: left;
        }
        
        /* 移动端励志语录优化 */
        @media (max-width: 768px) {
            .motto-quote {
                font-size: 1.3rem !important;
                line-height: 1.8 !important;
                margin-bottom: 18px !important;
            }
        }
        
        @media (max-width: 480px) {
            .motto-quote {
                font-size: 1.2rem !important;
                line-height: 1.6 !important;
                margin-bottom: 16px !important;
            }
        }
        .motto-author {
            font-size: 1.18rem;
            color: #3e2de2;
            text-align: right;
            width: 100%;
            font-weight: bold;
        }
        
        /* 移动端励志语录作者优化 */
        @media (max-width: 768px) {
            .motto-author {
                font-size: 1.1rem !important;
            }
        }
        
        @media (max-width: 480px) {
            .motto-author {
                font-size: 1rem !important;
            }
        }
        .motto-author em {
            color: #4a00e0;
            font-style: normal;
        }
        .main-card-calendar-inner {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        @media (max-width: 1100px) {
            #main-cards-row {
                flex-direction: column;
                align-items: center;
                gap: 32px;
            }
            .main-card {
                min-width: 0;
                max-width: 98vw;
                width: 98vw;
                padding: 28px 4vw 28px 4vw;
                min-height: 0;
            }
        }
        /* 日历切换学习表动画 */
        .fade-in {
            animation: fadeInAnim 0.4s;
        }
        .fade-out {
            animation: fadeOutAnim 0.4s;
        }
        @keyframes fadeInAnim {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes fadeOutAnim {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(20px); }
        }
        .timeline-scroll-container {
            height: 1000px;
            width: 100%;
            overflow-y: auto;
            padding-right: 2px;
            box-sizing: border-box;
        }
        
        /* 移动端时间线滚动容器优化 */
        @media (max-width: 768px) {
            .timeline-scroll-container {
                height: 600px;
                padding-right: 1px;
            }
        }
        
        @media (max-width: 480px) {
            .timeline-scroll-container {
                height: 500px;
            }
        }
        @media (max-width: 900px) {
            .timeline-scroll-container {
                height: 700px;
                min-width: 0;
                width: 100%;
                max-width: 98vw;
            }
        }
        
        /* 超小屏幕设备额外优化 */
        @media (max-width: 360px) {
            #calendar-view {
                max-width: 100%;
                width: 100%;
                padding: 12px 8px 8px 8px;
                box-sizing: border-box;
            }
            #calendar-view .calendar-grid {
                gap: 0px;
            }
            #calendar-view .calendar-title {
                font-size: 1.1rem;
                margin-bottom: 8px;
            }
            #calendar-view .calendar-header-btn {
                margin: 0 4px;
                padding: 2px 6px;
                font-size: 0.85rem;
            }
            #calendar-view .calendar-week-row div {
                font-size: 0.85rem;
            }
            #calendar-view .calendar-cell {
                padding: 2px 0 1px 0;
                font-size: 0.75rem;
                min-width: 18px;
                min-height: 18px;
            }
            #calendar-view .calendar-cell .calendar-badge {
                right: 0px;
                top: 0px;
                font-size: 0.55rem;
                padding: 0px 1px 0px 1px;
                min-width: 8px;
                min-height: 8px;
                line-height: 1;
                text-align: center;
                overflow: hidden;
            }
        }
    </style>
</head>
<body>
    <!-- 欢迎动画覆盖层 -->
    <div class="welcome-overlay" id="welcomeOverlay">
        <div class="welcome-content">
            <div class="welcome-icon">
                <i class="fas fa-clock"></i>
            </div>
            <div class="welcome-title">欢迎使用学习时间表</div>
            <div class="welcome-subtitle">正在为您加载个性化学习计划...</div>
            <div class="loading-bar">
                <div class="loading-progress"></div>
            </div>
        </div>
    </div>
    
    <!-- 全屏倒计时显示区域 - 翻页时钟风格 -->
    <div class="countdown-overlay" id="countdownOverlay">
        <div class="countdown-content">
            <div class="countdown-date" id="countdownDate"></div>
            <div class="countdown-task-name" id="countdownTaskName"></div>
            <div class="countdown-clock">
                <div class="countdown-time" id="countdownTime">
                    <div class="time-unit">
                        <div class="time-label">Hours</div>
                        <div class="time-digits">
                            <div class="time-digit" id="countdownHours1">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                            <div class="time-digit" id="countdownHours2">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="time-separator">:</div>
                    <div class="time-unit">
                        <div class="time-label">Minutes</div>
                        <div class="time-digits">
                            <div class="time-digit" id="countdownMinutes1">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                            <div class="time-digit" id="countdownMinutes2">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="time-separator">:</div>
                    <div class="time-unit">
                        <div class="time-label">Seconds</div>
                        <div class="time-digits">
                            <div class="time-digit" id="countdownSeconds1">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                            <div class="time-digit" id="countdownSeconds2">
                                <div class="digit-container">
                                    <div class="digit-current">0</div>
                                    <div class="digit-next">0</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="countdown-motto" id="countdownMotto">我现在没空,忙着优秀!</div>
        </div>
    </div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-clock"></i> 考研复习时间表 <span class="update-badge">增强版</span></h1>
            <p class="subtitle">
                单科连续学习时间≤45分钟 <br>
                科目交叉安排 | 高效休息机制
            </p>
        </header>
        <!-- 主卡片区：日历和励志语录并排 -->
        <div id="main-cards-row" style="display:flex;flex-direction:row;justify-content:center;align-items:stretch;gap:32px;margin:25px auto 0 auto;max-width:1000px;width:100%;transition:all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);transform:translateY(0) scale(1);filter:blur(0px);">
            <!-- 日历卡片 -->
            <div class="main-card" id="calendar-card">
                <div class="main-card-calendar-title"><i class="fas fa-calendar-alt"></i>学习日历</div>
                <div class="main-card-divider"></div>
                <div class="main-card-calendar-inner">
                    <div id="calendar-view"></div>
                </div>
            </div>
            <!-- 励志语录卡片 -->
            <div class="main-card" id="motto-card">
                <div class="main-card-title"><i class="fas fa-quote-left"></i>考研励志语录 <span class="edit-hint">(点击编辑，自动保存)</span></div>
                <div class="main-card-divider"></div>
                <div class="motto-list">
                    <div class="motto-item">
                        <div class="motto-quote" contenteditable="true" data-motto-id="1">"考研不是百米冲刺，而是马拉松。不在于某一天的爆发，而在于每一天的坚持。"</div>
                        <div class="motto-author" contenteditable="true" data-author-id="1">—— <em>致每一位坚持的考研人</em></div>
                    </div>
                    <div class="motto-item">
                        <div class="motto-quote" contenteditable="true" data-motto-id="2">"努力是奇迹的另一个名字，坚持是成功的不二法门。"</div>
                        <div class="motto-author" contenteditable="true" data-author-id="2">—— <em>考研路上的你</em></div>
                    </div>
                </div>
            </div>
        </div>
        

        <!-- 隐藏的时间安排模板，供JS克隆用 -->
        <div id="timeline-template" style="display:none;">
            <div class="timeline-scroll-container" style="max-width: 1000px; margin: 0 auto;">
            <div class="timeline">
                <div class="timeline-header">
                    <h2><i class="fas fa-calendar-alt"></i> 每日时间安排表</h2>
                </div>
                <div class="timeline-items">
                    <!-- 动态生成内容插入此处 -->
                </div>
            </div>
            </div>
        </div>
        <!-- 计时统计区和按钮容器并排 -->
        <div id="stat-row" style="display:flex;justify-content:center;align-items:stretch;gap:32px;margin:25px auto 32px auto;max-width:1000px;">
            <div id="stat-card-wrapper"></div>
            <div class="button-container">
                <button id="toggle-calendar-btn" class="card-toggle-btn">
                    <i class="fas fa-eye-slash"></i> 隐藏日历
                </button>
                <button id="toggle-motto-btn" class="card-toggle-btn" data-target="motto">
                    <i class="fas fa-eye-slash"></i> 隐藏励志语录
                </button>
                <div class="button-divider"></div>
                <button id="edit-mode-btn" class="stat-reset-btn" style="background:#ff9800;">
                    <i class="fas fa-edit"></i> 编辑时间表
                </button>
                <button id="reset-today-btn" class="stat-reset-btn">
                    重置今日记录
                </button>
        </div>
        </div>
        <div style="max-width: 1000px; margin: 0 auto;">
            <div id="back-to-ai-form-btn" style="text-align:center;margin:15px 0;">
            <a href="index.html" style="color:#26d0ce;font-size:1.1rem;text-decoration:underline;">返回自定义设置</a>
        </div>
        </div>
        <div style="max-width: 1000px; margin: 0 auto;">
        <div id="study-page-container"></div>
        </div>
                
        <div style="max-width: 1000px; margin: 0 auto;">
        <div class="principles">
            <div class="principle-card">
                <i class="fas fa-brain"></i>
                <h3>专注力优化</h3>
                <p>单科连续学习≤45分钟，符合大脑注意力周期</p>
                </div>
            <div class="principle-card">
                <i class="fas fa-language"></i>
                <h3>英语三段学习</h3>
                <p>英语拆分为三个30分钟模块，提高记忆效率</p>
                    </div>
            <div class="principle-card">
                <i class="fas fa-heartbeat"></i>
                <h3>科学休息</h3>
                <p>每45分钟学习后休息5-10分钟，提升效率</p>
                        </div>
                    </div>
        </div>
        
        <div style="max-width: 1000px; margin: 0 auto;">
        <footer>
            <p>高效考研时间表 | 英语三段学习法 | 遵循认知科学规律 © 2023</p>
            <p>提示：本时间表可根据个人学习节奏微调，保持规律作息是成功的关键</p>
        </footer>
        </div>
    </div>

    <script>
        const DEFAULT_PARAMS = {
          startTime: "09:00",
          studyDuration: 45,
          breakDuration: 10,
          lunchTime: "12:20",
          lunchDuration: 55,
          dinnerTime: "17:25",
          dinnerDuration: 45,
          reviewTime: "21:50",
          reviewDuration: 30,
          subjects: [
            { name: "数学", count: 2 },
            { name: "英语", count: 2 },
            { name: "专业课", count: 2 },
            { name: "政治", count: 1 }
          ]
        };

        document.addEventListener('DOMContentLoaded', function() {
            // ========== 欢迎动画控制 ==========
            const welcomeOverlay = document.getElementById('welcomeOverlay');
            
            // 检查是否是从设置页面跳转过来的
            const isFromSetup = sessionStorage.getItem('fromSetup') === 'true';
            
            if (isFromSetup) {
                // 清除标记
                sessionStorage.removeItem('fromSetup');
                
                // 显示欢迎动画
                setTimeout(() => {
                    welcomeOverlay.classList.add('fade-out');
                    setTimeout(() => {
                        welcomeOverlay.style.display = 'none';
                    }, 800);
                }, 2000); // 显示2秒后淡出
            } else {
                // 直接隐藏欢迎动画
                welcomeOverlay.style.display = 'none';
            }
            
            // ========== 编辑模式状态管理 ==========
            let editMode = false;
            let draggedElement = null;
            
            // ========== 卡片控制功能 ==========
            initCardControls();
            
            function adjustLayout() {
                const mainCardsRow = document.getElementById('main-cards-row');
                const calendarCard = document.getElementById('calendar-card');
                const mottoCard = document.getElementById('motto-card');
                
                const calendarHidden = calendarCard.classList.contains('hidden');
                const mottoHidden = mottoCard.classList.contains('hidden');
                
                // 如果两个卡片都隐藏，延迟隐藏整个主卡片行
                if (calendarHidden && mottoHidden) {
                    mainCardsRow.style.gap = '0px';
                    // 延迟300ms后隐藏容器，让卡片动画先完成
                    setTimeout(() => {
                        mainCardsRow.classList.add('all-hidden');
                    }, 300);
                } else {
                    // 有卡片显示，立即显示主卡片行
                    mainCardsRow.classList.remove('all-hidden');
                    
                    if (calendarHidden || mottoHidden) {
                        // 只有一个卡片隐藏，调整间距
                        mainCardsRow.style.gap = '0px';
                    } else {
                        // 两个卡片都显示，恢复正常间距
                        mainCardsRow.style.gap = '32px';
                    }
                }
            }
            
            function initCardControls() {
                const calendarBtn = document.getElementById('toggle-calendar-btn');
                const mottoBtn = document.getElementById('toggle-motto-btn');
                const calendarCard = document.getElementById('calendar-card');
                const mottoCard = document.getElementById('motto-card');
                
                // 从localStorage恢复状态
                const calendarHidden = localStorage.getItem('calendar_hidden') === 'true';
                const mottoHidden = localStorage.getItem('motto_hidden') === 'true';
                
                if (calendarHidden) {
                    calendarCard.classList.add('hidden');
                    calendarBtn.classList.add('show');
                    calendarBtn.innerHTML = '<i class="fas fa-eye"></i> 显示日历';
                }
                
                if (mottoHidden) {
                    mottoCard.classList.add('hidden');
                    mottoBtn.classList.add('show');
                    mottoBtn.innerHTML = '<i class="fas fa-eye"></i> 显示励志语录';
                }
                
                // 初始化时调整布局
                adjustLayout();
                
                // 日历控制
                calendarBtn.addEventListener('click', function() {
                    if (calendarCard.classList.contains('hidden')) {
                        // 显示日历
                        calendarCard.classList.remove('hidden');
                        this.classList.remove('show');
                        this.innerHTML = '<i class="fas fa-eye-slash"></i> 隐藏日历';
                        localStorage.setItem('calendar_hidden', 'false');
                        // 调整布局
                        adjustLayout();
                    } else {
                        // 隐藏日历
                        calendarCard.classList.add('hidden');
                        this.classList.add('show');
                        this.innerHTML = '<i class="fas fa-eye"></i> 显示日历';
                        localStorage.setItem('calendar_hidden', 'true');
                        // 调整布局
                        adjustLayout();
                    }
                });
                
                // 励志语录控制
                mottoBtn.addEventListener('click', function() {
                    if (mottoCard.classList.contains('hidden')) {
                        // 显示励志语录
                        mottoCard.classList.remove('hidden');
                        this.classList.remove('show');
                        this.innerHTML = '<i class="fas fa-eye-slash"></i> 隐藏励志语录';
                        localStorage.setItem('motto_hidden', 'false');
                        // 调整布局
                        adjustLayout();
                    } else {
                        // 隐藏励志语录
                        mottoCard.classList.add('hidden');
                        this.classList.add('show');
                        this.innerHTML = '<i class="fas fa-eye"></i> 显示励志语录';
                        localStorage.setItem('motto_hidden', 'true');
                        // 调整布局
                        adjustLayout();
                    }
                });
            }
            
            // ========== 计算计划总学习时长 ==========
            window.calculateTotalStudyTime = function() {
                // 由于页面标题中的total-study-time元素已被移除，此函数现在主要用于统计卡片
                // 统计卡片中的计划总学习时长会在updateStatCard函数中直接计算

            };
            
            // ========== 日期与本地存储工具 ==========
            function getTodayStr() {
                const d = new Date();
                return d.getFullYear() + '-' + String(d.getMonth()+1).padStart(2, '0') + '-' + String(d.getDate()).padStart(2, '0');
            }
            function getMonthStr(date) {
                return date.getFullYear() + '-' + String(date.getMonth()+1).padStart(2, '0');
            }
            function getTaskStorageKey(dateStr) {
                return 'study_tasks_' + dateStr;
            }
            function getTimerStorageKey(dateStr) {
                return 'study_timer_' + dateStr;
            }
            function getSummaryStorageKey(dateStr) {
                return 'study_summary_' + dateStr;
            }
            function getCompletedCount(tasks) {
                return tasks ? tasks.filter(Boolean).length : 0;
            }

            // ========== 全局当前查看日期 ==========
            let currentViewDate = getTodayStr();

            // ========== 自动重置任务状态 ========== 
            const todayStr = getTodayStr();
            const lastDate = localStorage.getItem('study_last_date');
            if (lastDate !== todayStr) {
                // 新的一天，重置所有任务状态
                document.querySelectorAll('.timeline-item').forEach((item, idx) => {
                    item.classList.remove('completed', 'active-task');
                    item.removeAttribute('data-remaining-seconds');
                    // 重置按钮
                    const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                    if (startBtn) {
                        startBtn.innerHTML = '<i class="fas fa-play"></i> ' + (item.querySelector('.subject.review') ? '开始复盘' : (item.querySelector('.subject.rest') ? '开始休息' : '开始学习'));
                        startBtn.className = 'btn btn-start';
                    }
                    const completeBtn = item.querySelector('.btn-complete');
                    if (completeBtn) {
                        completeBtn.innerHTML = '<i class="fas fa-check"></i> ' + (item.querySelector('.subject.review') ? '完成复盘' : (item.querySelector('.subject.rest') ? '完成休息' : '完成学习'));
                        completeBtn.classList.remove('completed');
                    }
                    // 重置计时器
                    const timer = item.querySelector('.timer');
                    if (timer) {
                        timer.textContent = '';
                        timer.classList.remove('timer-running', 'timer-completed');
                    }
                });
                // 清空今日任务完成状态
                localStorage.setItem(getTaskStorageKey(todayStr), JSON.stringify([]));
                // 清空今日计时器状态
                localStorage.setItem(getTimerStorageKey(todayStr), JSON.stringify([]));
                // 清空今日总结
                localStorage.setItem(getSummaryStorageKey(todayStr), '');
                localStorage.setItem('study_last_date', todayStr);
            }

            // ========== 恢复任务完成状态 ========== 
            let taskItems = Array.from(document.querySelectorAll('.timeline-item'));
            let todayTasks = JSON.parse(localStorage.getItem(getTaskStorageKey(todayStr)) || '[]');
            taskItems.forEach((item, idx) => {
                if (todayTasks[idx]) {
                    // 标记为已完成
                    item.classList.add('completed');
                    item.classList.remove('active-task');
                    
                    // 按钮
                    const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                    if (startBtn) {
                        startBtn.innerHTML = '<i class="fas fa-play"></i> 重新开始';
                        startBtn.classList.remove('btn-pause', 'btn-resume');
                        startBtn.classList.add('btn-start');
                    }
                    const completeBtn = item.querySelector('.btn-complete');
                    if (completeBtn) {
                        completeBtn.innerHTML = '<i class="fas fa-check"></i> 已完成';
                        completeBtn.classList.add('completed');
                    }
                    // 计时器
                    const timer = item.querySelector('.timer');
                    if (timer) {
                        timer.textContent = '00:00';
                        timer.classList.remove('timer-running');
                        timer.classList.add('timer-completed');
                    }
                }
            });

            // ========== 初始化励志语录编辑器 ==========
            setTimeout(() => {
                initMottoEditor();
            }, 100);
            
            // ========== 初始化倒计时显示 ==========
            setTimeout(() => {
                initCountdownElements();
                

            }, 200);

            // ========== 日历视图 ========== 
            function renderCalendar(monthDate) {
                const calendarDiv = document.getElementById('calendar-view');
                calendarDiv.innerHTML = '';
                const year = monthDate.getFullYear();
                const month = monthDate.getMonth();
                const firstDay = new Date(year, month, 1);
                const lastDay = new Date(year, month+1, 0);
                const today = getTodayStr();
                // 标题
                const title = document.createElement('div');
                title.className = 'calendar-title';
                title.innerHTML = `<button class="calendar-header-btn" id="prev-month">&lt;</button>${year}年${month+1}月<button class="calendar-header-btn" id="next-month">&gt;</button>`;
                calendarDiv.appendChild(title);
                // 星期
                const weekRow = document.createElement('div');
                weekRow.className = 'calendar-week-row';
                ['日','一','二','三','四','五','六'].forEach(w=>{
                    const d = document.createElement('div');
                    d.textContent = w;
                    weekRow.appendChild(d);
                });
                calendarDiv.appendChild(weekRow);
                // 日期格
                const grid = document.createElement('div');
                grid.className = 'calendar-grid';
                // 填充空白
                for(let i=0;i<firstDay.getDay();i++){
                    const empty = document.createElement('div');
                    grid.appendChild(empty);
                }
                // 填充日期
                for(let d=1;d<=lastDay.getDate();d++){
                    const dateStr = year+'-'+String(month+1).padStart(2,'0')+'-'+String(d).padStart(2,'0');
                    const cell = document.createElement('div');
                    cell.className = 'calendar-cell';
                    if(dateStr === today) cell.classList.add('today');
                    if(dateStr === currentViewDate) cell.classList.add('selected');
                    cell.textContent = d;
                    cell.style.position = 'relative';
                    // 读取完成数和总数
                    const tasks = JSON.parse(localStorage.getItem(getTaskStorageKey(dateStr))||'[]');
                    const completed = getCompletedCount(tasks);
                    // 计算完成率并着色（修正版）
                    if (tasks.length > 0 && completed > 0) {
                        const percent = completed / tasks.length;
                        if (percent === 1) {
                            cell.style.background = 'linear-gradient(90deg,#38ef7d,#11998e)';
                            cell.style.color = '#fff';
                        } else if (percent >= 0.5) {
                            cell.style.background = 'linear-gradient(90deg,#ffe259,#ffa751)';
                            cell.style.color = '#fff';
                        } else {
                            cell.style.background = 'linear-gradient(90deg,#ff5858,#f09819)';
                            cell.style.color = '#fff';
                        }
                    }
                    if(completed>0) {
                        const badge = document.createElement('span');
                        badge.textContent = completed;
                        badge.className = 'calendar-badge';
                        badge.title = '已完成任务数';
                        cell.appendChild(badge);
                    }
                    cell.addEventListener('click',()=>{
                        // 保存当前日期状态后再切换日期
                        const timeline = document.querySelector('#study-page-container .timeline');
                        const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                        saveDayState(currentViewDate, taskItems);
                        
                        // 更新当前查看日期
                        currentViewDate = dateStr;
                        renderCalendar(new Date(year, month, 1));
                        
                        // 动画：先fade-out
                        const container = document.getElementById('study-page-container');
                        container.classList.remove('fade-in');
                        container.classList.add('fade-out');
                        setTimeout(()=>{
                            container.innerHTML = '';
                            // 克隆模板
                            const template = document.querySelector('#timeline-template .timeline');
                            if (template) {
                                const timelineClone = template.cloneNode(true);
                                // 修改标题为日期
                                const header = timelineClone.querySelector('.timeline-header');
                                if (header) {
                                    header.innerHTML = `<h2 id="schedule-title" style="font-size:1.25rem;color:#1a2980;font-weight:bold;margin:0 0 10px 0;display:inline-block;vertical-align:middle;"><i class='fas fa-calendar-alt'></i> ${dateStr} 时间安排表</h2>`;
                                    header.style.background = 'none';
                                    header.style.color = '#1a2980';
                                    header.style.boxShadow = 'none';
                                    header.style.border = 'none';
                                    header.style.padding = '18px 0 8px 0';
                                }
                                // 恢复目标日期的任务状态
                                const items = Array.from(timelineClone.querySelectorAll('.timeline-item'));
                                restoreDayState(dateStr, items);
                                
                                // 限制编辑功能：只在当前日期允许编辑
                                if (dateStr !== getTodayStr()) {
                                    // 非当前日期禁用所有操作按钮
                                    items.forEach(item => {
                                        const buttons = item.querySelectorAll('.btn');
                                        buttons.forEach(btn => {
                                            btn.disabled = true;
                                            btn.style.opacity = '0.5';
                                            btn.style.cursor = 'not-allowed';
                                        });
                                    });
                                }
                                
                                const scrollContainer = document.createElement('div');
                                scrollContainer.className = 'timeline-scroll-container';
                                scrollContainer.appendChild(timelineClone);
                                container.appendChild(scrollContainer);
                            }
                            container.classList.remove('fade-out');
                            container.classList.add('fade-in');
                            
                            // 更新统计卡片显示选中日期的学习数据
                            updateStatCard(dateStr);
                        }, 400);
                    });
                    grid.appendChild(cell);
                }
                calendarDiv.appendChild(grid);
                // 月份切换
                document.getElementById('prev-month').onclick = ()=>{
                    renderCalendar(new Date(year, month-1, 1));
                };
                document.getElementById('next-month').onclick = ()=>{
                    renderCalendar(new Date(year, month+1, 1));
                };
            }

            // ========== 渲染学习页面（时间表+总结） ========== 
            // 复制原有 .schedule-container 和 .notes 区域，动态渲染
            window.renderStudyPage = function(dateStr) {
                const container = document.getElementById('study-page-container');
                // 移除日期限制，允许渲染任何日期的页面
                if (!dateStr) {
                    container.innerHTML = '';
                    return;
                }
                // 任务模板
                const timeline = document.querySelector('#timeline-template .timeline');
                if (!timeline) return;
                // 只复制时间表部分，不复制大卡片和头部
                const timelineClone = timeline.cloneNode(true);
                // 修改标题为日期（不再用大卡片背景）
                const header = timelineClone.querySelector('.timeline-header');
                if (header) {
                    header.innerHTML = `<h2 id="schedule-title" style="font-size:1.25rem;color:#1a2980;font-weight:bold;margin:0 0 10px 0;display:inline-block;vertical-align:middle;"><i class='fas fa-calendar-alt'></i> ${dateStr} 时间安排表</h2>`;
                    header.style.background = 'none';
                    header.style.color = '#1a2980';
                    header.style.boxShadow = 'none';
                    header.style.border = 'none';
                    header.style.padding = '18px 0 8px 0';
                }
                const taskItems = Array.from(timelineClone.querySelectorAll('.timeline-item'));
                restoreDayState(dateStr, taskItems);
                
                // 限制编辑功能：只在当前日期允许编辑
                if (dateStr !== getTodayStr()) {
                    // 非当前日期禁用所有操作按钮
                    taskItems.forEach(item => {
                        const buttons = item.querySelectorAll('.btn');
                        buttons.forEach(btn => {
                            btn.disabled = true;
                            btn.style.opacity = '0.5';
                            btn.style.cursor = 'not-allowed';
                        });
                    });
                }
                
                // 事件处理已移至全局document事件监听器，避免重复处理
                container.innerHTML = '';
                const scrollContainer = document.createElement('div');
                scrollContainer.className = 'timeline-scroll-container';
                scrollContainer.appendChild(timelineClone);
                container.appendChild(scrollContainer);
                
                // 如果当前是编辑模式且是当前日期，重新启用拖拽功能
                if (editMode && dateStr === getTodayStr()) {
                    enableDragAndDrop();
                }
                
                // 更新统计卡片显示当前日期的学习数据
                updateStatCard(dateStr);
            }

            // ========== 首次渲染 ========== 
            renderCalendar(new Date());
            
            // 立即初始化统计卡片，避免延时显示
            updateStatCard(currentViewDate);
            
            renderStudyPage(currentViewDate);
            
            // 确保页面加载完成后自动渲染时间表
            const paramsStr = localStorage.getItem('custom_schedule_params');
            if (paramsStr) {
                try {
                    const params = JSON.parse(paramsStr);
                    generateCustomSchedule(params);
                    renderStudyPage(currentViewDate);
                    
                    // 时间线渲染完成后，更新统计卡片
                    setTimeout(() => {
                        updateStatCard(currentViewDate);
                    }, 100);
                    
                    // 尝试恢复自定义顺序
                    setTimeout(() => {
                        const customOrder = loadCustomOrder();
                        if (customOrder) {
            
                            // 这里可以添加应用自定义顺序的逻辑
                        }
                    }, 500);
                } catch (e) {
                    console.error('Error rendering schedule:', e);
                }
            } else {
                // 如果没有参数，也要确保统计卡片显示
                setTimeout(() => {
                    updateStatCard(currentViewDate);
                }, 100);
            }
            


            // 绑定按钮事件
            document.addEventListener('click', function(e) {
                if (e.target.id === 'reset-today-btn') {
                    const todayStr = getTodayStr();
                    if(confirm('确定要重置今日所有学习记录吗？')) {
                        // 清空本地存储
                        localStorage.setItem(getTaskStorageKey(todayStr), JSON.stringify([]));
                        localStorage.setItem(getSummaryStorageKey(todayStr), '');
                        localStorage.setItem(getTimerStorageKey(todayStr), JSON.stringify([]));
                        
                        // 清空模板中的计时状态
                        const templateTimeline = document.querySelector('#timeline-template .timeline');
                        const templateItems = templateTimeline ? Array.from(templateTimeline.querySelectorAll('.timeline-item')) : [];
                        if (templateTimeline) {
                            templateItems.forEach(item => {
                                item.removeAttribute('data-remaining-seconds');
                                item.classList.remove('completed', 'active-task');
                                // 重置按钮状态
                                const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                                if (startBtn) {
                                    startBtn.innerHTML = '<i class="fas fa-play"></i> ' + (item.querySelector('.subject.review') ? '开始复盘' : (item.querySelector('.subject.rest') ? '开始休息' : '开始学习'));
                                    startBtn.className = 'btn btn-start';
                                }
                                const completeBtn = item.querySelector('.btn-complete');
                                if (completeBtn) {
                                    completeBtn.innerHTML = '<i class="fas fa-check"></i> ' + (item.querySelector('.subject.review') ? '完成复盘' : (item.querySelector('.subject.rest') ? '完成休息' : '完成学习'));
                                    completeBtn.classList.remove('completed');
                                }
                                // 重置计时器显示
                                const timer = item.querySelector('.timer');
                                if (timer) {
                                    timer.textContent = '';
                                    timer.classList.remove('timer-running', 'timer-completed');
                                }
                            });
                        }
                        
                        // 清空主页面中的计时状态
                        const mainTimeline = document.querySelector('#study-page-container .timeline');
                        const mainItems = mainTimeline ? Array.from(mainTimeline.querySelectorAll('.timeline-item')) : [];
                        if (mainTimeline) {
                            mainItems.forEach(item => {
                                item.removeAttribute('data-remaining-seconds');
                                item.classList.remove('completed', 'active-task');
                                // 重置按钮状态
                                const startBtn = item.querySelector('.btn-start, .btn-pause, .btn-resume');
                        if (startBtn) {
                                    startBtn.innerHTML = '<i class="fas fa-play"></i> ' + (item.querySelector('.subject.review') ? '开始复盘' : (item.querySelector('.subject.rest') ? '开始休息' : '开始学习'));
                                    startBtn.className = 'btn btn-start';
                        }
                                const completeBtn = item.querySelector('.btn-complete');
                        if (completeBtn) {
                                    completeBtn.innerHTML = '<i class="fas fa-check"></i> ' + (item.querySelector('.subject.review') ? '完成复盘' : (item.querySelector('.subject.rest') ? '完成休息' : '完成学习'));
                                    completeBtn.classList.remove('completed');
                                }
                                // 重置计时器显示
                                const timer = item.querySelector('.timer');
                                if (timer) {
                                    timer.textContent = '';
                                    timer.classList.remove('timer-running', 'timer-completed');
                                }
                            });
                        }
                        
                        // 停止全局计时器
                        if (globalTimerInterval) {
                            clearInterval(globalTimerInterval);
                            globalTimerInterval = null;
                        }
                            globalActiveTask = null;
                        
                        // 立即刷新统计区和页面
                        setTimeout(() => {
                            updateStatCard(todayStr);
                            renderStudyPage(todayStr);
                        }, 50);
                    }
                }
            });

            // ========== 保持原有计时器/按钮功能（仅今日页面生效） ========== 
            // 存储当前活动任务和计时器
            let globalActiveTask = null;
            let globalTimerInterval = null;
            
            // 倒计时显示相关变量
            let countdownOverlay = null;
            let countdownTaskName = null;
            let countdownDate = null;
            let countdownHours1 = null;
            let countdownHours2 = null;
            let countdownMinutes1 = null;
            let countdownMinutes2 = null;
            let countdownSeconds1 = null;
            let countdownSeconds2 = null;
            let countdownMotto = null;
            let countdownTotalSeconds = 0;
            let countdownCurrentSeconds = 0;
            let countdownInitialized = false;
            
            // 翻页时钟相关变量
            let lastHours1 = 0;
            let lastHours2 = 0;
            let lastMinutes1 = 0;
            let lastMinutes2 = 0;
            let lastSeconds1 = 0;
            let lastSeconds2 = 0;
            
                        // 初始化倒计时显示元素
            function initCountdownElements() {
                // 如果已经初始化过，直接返回
                if (countdownInitialized) {
                    return;
                }
                
                countdownOverlay = document.getElementById('countdownOverlay');
                countdownTaskName = document.getElementById('countdownTaskName');
                countdownDate = document.getElementById('countdownDate');
                countdownHours1 = document.getElementById('countdownHours1');
                countdownHours2 = document.getElementById('countdownHours2');
                countdownMinutes1 = document.getElementById('countdownMinutes1');
                countdownMinutes2 = document.getElementById('countdownMinutes2');
                countdownSeconds1 = document.getElementById('countdownSeconds1');
                countdownSeconds2 = document.getElementById('countdownSeconds2');
                countdownMotto = document.getElementById('countdownMotto');
                
                if (!countdownOverlay || !countdownTaskName || !countdownDate || 
                    !countdownHours1 || !countdownHours2 || !countdownMinutes1 || !countdownMinutes2 || 
                    !countdownSeconds1 || !countdownSeconds2 || !countdownMotto) {
                    console.error('倒计时元素初始化失败');
                    return;
                }
                
                // 点击倒计时区域外关闭
                countdownOverlay.addEventListener('click', function(e) {
                    if (e.target === countdownOverlay) {
                        hideCountdown();
                    }
                });
                
                // 键盘ESC键关闭倒计时
                document.addEventListener('keydown', function(e) {
                    if (e.key === 'Escape' && countdownOverlay.classList.contains('show')) {
                        hideCountdown();
                    }
                });
                

                countdownInitialized = true;
            }
            
            // 显示倒计时
            function showCountdown(taskName, totalSeconds) {
                // 如果倒计时元素未初始化，尝试重新初始化
                if (!countdownInitialized || !countdownOverlay) {
                    initCountdownElements();
                }
                
                if (!countdownOverlay) {
                    return;
                }
                
                countdownTotalSeconds = totalSeconds;
                countdownCurrentSeconds = totalSeconds;
                
                // 设置当前日期
                const now = new Date();
                const dateStr = `${now.getFullYear()}年${now.getMonth() + 1}月${now.getDate()}日 ${['日', '一', '二', '三', '四', '五', '六'][now.getDay()]}`;
                countdownDate.textContent = dateStr;
                
                countdownTaskName.textContent = taskName;
                
                // 随机显示励志语录
                const mottos = [
                    "我现在没空,忙着优秀!",
                    "每一分钟的努力，都是未来的礼物",
                    "专注当下，成就未来",
                    "坚持就是胜利的开始",
                    "今天的努力，明天的收获",
                    "时间不会辜负每一个努力的人",
                    "专注学习，成就梦想",
                    "每一秒的坚持，都是进步"
                ];
                const randomMotto = mottos[Math.floor(Math.random() * mottos.length)];
                countdownMotto.textContent = randomMotto;
                
                // 初始化翻页时钟的当前值
                const hours = Math.floor(totalSeconds / 3600);
                const minutes = Math.floor((totalSeconds % 3600) / 60);
                const seconds = totalSeconds % 60;
                
                const hoursStr = hours.toString().padStart(2, '0');
                const minutesStr = minutes.toString().padStart(2, '0');
                const secondsStr = seconds.toString().padStart(2, '0');
                
                lastHours1 = parseInt(hoursStr[0]);
                lastHours2 = parseInt(hoursStr[1]);
                lastMinutes1 = parseInt(minutesStr[0]);
                lastMinutes2 = parseInt(minutesStr[1]);
                lastSeconds1 = parseInt(secondsStr[0]);
                lastSeconds2 = parseInt(secondsStr[1]);
                
                // 设置初始显示值
                const hours1Element = countdownHours1.querySelector('.digit-current');
                const hours2Element = countdownHours2.querySelector('.digit-current');
                const minutes1Element = countdownMinutes1.querySelector('.digit-current');
                const minutes2Element = countdownMinutes2.querySelector('.digit-current');
                const seconds1Element = countdownSeconds1.querySelector('.digit-current');
                const seconds2Element = countdownSeconds2.querySelector('.digit-current');
                
                if (hours1Element) hours1Element.textContent = hoursStr[0];
                if (hours2Element) hours2Element.textContent = hoursStr[1];
                if (minutes1Element) minutes1Element.textContent = minutesStr[0];
                if (minutes2Element) minutes2Element.textContent = minutesStr[1];
                if (seconds1Element) seconds1Element.textContent = secondsStr[0];
                if (seconds2Element) seconds2Element.textContent = secondsStr[1];
                
                updateCountdownDisplay();
                countdownOverlay.classList.add('show');
            }
            
            // 隐藏倒计时
            function hideCountdown() {
                // 如果倒计时元素未初始化，尝试重新初始化
                if (!countdownInitialized || !countdownOverlay) {
                    initCountdownElements();
                }
                
                if (!countdownOverlay) {
                    return;
                }
                countdownOverlay.classList.remove('show');
            }
            
            // 更新倒计时显示
            function updateCountdownDisplay() {
                // 如果倒计时元素未初始化，尝试重新初始化
                if (!countdownInitialized || !countdownHours1 || !countdownHours2 || !countdownMinutes1 || !countdownMinutes2 || !countdownSeconds1 || !countdownSeconds2) {
                    initCountdownElements();
                }
                
                if (!countdownHours1 || !countdownHours2 || !countdownMinutes1 || !countdownMinutes2 || !countdownSeconds1 || !countdownSeconds2) {
                    return;
                }
                
                const hours = Math.floor(countdownCurrentSeconds / 3600);
                const minutes = Math.floor((countdownCurrentSeconds % 3600) / 60);
                const seconds = countdownCurrentSeconds % 60;
                
                const hoursStr = hours.toString().padStart(2, '0');
                const minutesStr = minutes.toString().padStart(2, '0');
                const secondsStr = seconds.toString().padStart(2, '0');
                
                // 更新小时第一位，带翻页效果
                if (parseInt(hoursStr[0]) !== lastHours1) {
                    updateDigitWithFlip(countdownHours1, hoursStr[0]);
                    lastHours1 = parseInt(hoursStr[0]);
                }
                
                // 更新小时第二位，带翻页效果
                if (parseInt(hoursStr[1]) !== lastHours2) {
                    updateDigitWithFlip(countdownHours2, hoursStr[1]);
                    lastHours2 = parseInt(hoursStr[1]);
                }
                
                // 更新分钟第一位，带翻页效果
                if (parseInt(minutesStr[0]) !== lastMinutes1) {
                    updateDigitWithFlip(countdownMinutes1, minutesStr[0]);
                    lastMinutes1 = parseInt(minutesStr[0]);
                }
                
                // 更新分钟第二位，带翻页效果
                if (parseInt(minutesStr[1]) !== lastMinutes2) {
                    updateDigitWithFlip(countdownMinutes2, minutesStr[1]);
                    lastMinutes2 = parseInt(minutesStr[1]);
                }
                
                // 更新秒数第一位，带翻页效果
                if (parseInt(secondsStr[0]) !== lastSeconds1) {
                    updateDigitWithFlip(countdownSeconds1, secondsStr[0]);
                    lastSeconds1 = parseInt(secondsStr[0]);
                }
                
                // 更新秒数第二位，带翻页效果
                if (parseInt(secondsStr[1]) !== lastSeconds2) {
                    updateDigitWithFlip(countdownSeconds2, secondsStr[1]);
                    lastSeconds2 = parseInt(secondsStr[1]);
                }
            }
            
            // 带翻页效果的数字更新
            function updateDigitWithFlip(digitElement, newValue) {
                const currentDigit = digitElement.querySelector('.digit-current');
                const nextDigit = digitElement.querySelector('.digit-next');
                
                if (currentDigit && nextDigit) {
                    // 设置下一个数字
                    nextDigit.textContent = newValue;
                    
                    // 添加翻页动画
                    digitElement.classList.add('digit-flip');
                    
                    // 动画结束后更新当前数字并移除动画类
                    setTimeout(() => {
                        currentDigit.textContent = newValue;
                        digitElement.classList.remove('digit-flip');
                    }, 400);
                }
            }
            
            // 为所有按钮添加事件委托
            document.addEventListener('click', function(e) {
                const target = e.target;
                const btn = target.closest('.btn');
                if (!btn) return;
                
                const taskItem = btn.closest('.timeline-item');
                if (!taskItem) return;
                
                // 确保按钮在study-page-container中
                if (!taskItem.closest('#study-page-container')) return;
                
                // 计时器功能：仅允许在当前日期启动计时器
                if (currentViewDate !== getTodayStr()) {
                    // 非当前日期，阻止所有计时器相关操作
                    if (btn.classList.contains('btn-start') || btn.classList.contains('btn-pause') || btn.classList.contains('btn-resume')) {
                        alert('只能在当前日期启动计时器');
                        return;
                    }
                }
                
                // 处理开始/暂停/继续按钮
                if (btn.classList.contains('btn-start')) {
                    startTask(taskItem);
                } 
                else if (btn.classList.contains('btn-pause')) {
                    pauseTask(taskItem);
                } 
                else if (btn.classList.contains('btn-resume')) {
                    resumeTask(taskItem);
                } 
                else if (btn.classList.contains('btn-complete')) {
                    completeTask(taskItem);
                }
            });
            
            // 开始任务
            function startTask(taskItem) {
                // 如果任务已完成，不能再次开始
                if (taskItem.classList.contains('completed')) return;
                
                // 如果已有活动任务，先暂停它（但不更新按钮状态）
                if (globalActiveTask && globalActiveTask !== taskItem) {
                    // 只清除计时器和隐藏倒计时，不更新按钮状态
                    if (globalTimerInterval) {
                        clearInterval(globalTimerInterval);
                        globalTimerInterval = null;
                    }
                    hideCountdown();
                    globalActiveTask.classList.remove('active-task');
                }
                
                // 设置新活动任务
                globalActiveTask = taskItem;
                taskItem.classList.add('active-task');
                
                // 获取任务持续时间（分钟）并转换为秒
                const duration = parseInt(taskItem.dataset.duration) * 60;
                
                // 初始化或恢复剩余时间
                let remainingSeconds = taskItem.dataset.remainingSeconds 
                    ? parseInt(taskItem.dataset.remainingSeconds) 
                    : duration;
                
                // 获取任务名称
                const taskNameElement = taskItem.querySelector('.activity-title');
                const taskName = taskNameElement ? taskNameElement.textContent.split(' ')[0] : '学习任务';
                
                // 显示全屏倒计时
                showCountdown(taskName, remainingSeconds);
                
                // 更新按钮状态
                const startBtn = taskItem.querySelector('.btn-start, .btn-resume, .btn.btn-start, .btn.btn-resume');
                if (startBtn) {
                startBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                startBtn.classList.remove('btn-start', 'btn-resume');
                startBtn.classList.add('btn-pause');
                }
                
                // 清除现有计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                }
                
                // 开始计时器
                globalTimerInterval = setInterval(function() {
                    remainingSeconds--;
                    taskItem.dataset.remainingSeconds = remainingSeconds;
                    countdownCurrentSeconds = remainingSeconds;
                    
                    // 更新显示
                    updateTimerDisplay(taskItem, remainingSeconds);
                    updateCountdownDisplay();
                    
                    // 每30秒更新一次统计卡片（避免频繁更新）
                    if (remainingSeconds % 30 === 0) {
                        updateStatCard(getTodayStr());
                    }
                    
                    // 检查是否结束
                    if (remainingSeconds <= 0) {
                        clearInterval(globalTimerInterval);
                        globalTimerInterval = null;
                        hideCountdown();
                        completeTask(taskItem);
                    }
                }, 1000);
                
                // 初始化显示
                updateTimerDisplay(taskItem, remainingSeconds);
                
                // 更新统计卡片显示科目时间分布
                setTimeout(() => {
                    updateStatCard(getTodayStr());
                }, 100);
            }
            
            // 暂停任务
            function pauseTask(taskItem) {
                // 确保暂停的是当前活动任务
                if (taskItem !== globalActiveTask) {
                    return;
                }
                
                // 清除计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                    globalTimerInterval = null;
                }
                
                // 隐藏全屏倒计时
                hideCountdown();
                
                // 更新按钮状态
                const pauseBtn = taskItem.querySelector('.btn-pause, .btn.btn-pause');
                if (pauseBtn) {
                pauseBtn.innerHTML = '<i class="fas fa-play"></i> 继续';
                pauseBtn.classList.remove('btn-pause');
                pauseBtn.classList.add('btn-resume');
                }
                
                // 移除高亮动画
                const timerDisplay = taskItem.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.classList.remove('timer-running');
                }
                
                // 更新统计卡片显示科目时间分布
                setTimeout(() => {
                    updateStatCard(getTodayStr());
                }, 100);
            }
            
            // 继续任务
            function resumeTask(taskItem) {
                // 确保继续的是当前活动任务
                if (taskItem !== globalActiveTask) return;
                
                // 获取剩余时间
                const remainingSeconds = parseInt(taskItem.dataset.remainingSeconds);
                
                // 获取任务名称
                const taskNameElement = taskItem.querySelector('.activity-title');
                const taskName = taskNameElement ? taskNameElement.textContent.split(' ')[0] : '学习任务';
                
                // 重新显示全屏倒计时
                showCountdown(taskName, remainingSeconds);
                
                // 更新按钮状态
                const resumeBtn = taskItem.querySelector('.btn-resume, .btn.btn-resume');
                if (resumeBtn) {
                resumeBtn.innerHTML = '<i class="fas fa-pause"></i> 暂停';
                resumeBtn.classList.remove('btn-resume');
                resumeBtn.classList.add('btn-pause');
                }
                
                // 添加高亮动画
                const timerDisplay = taskItem.querySelector('.timer');
                if (timerDisplay) {
                    timerDisplay.classList.add('timer-running');
                }
                
                // 开始计时器
                globalTimerInterval = setInterval(function() {
                    let seconds = parseInt(taskItem.dataset.remainingSeconds) - 1;
                    taskItem.dataset.remainingSeconds = seconds;
                    countdownCurrentSeconds = seconds;
                    
                    // 更新显示
                    updateTimerDisplay(taskItem, seconds);
                    updateCountdownDisplay();
                    
                    // 检查是否结束
                    if (seconds <= 0) {
                        clearInterval(globalTimerInterval);
                        globalTimerInterval = null;
                        hideCountdown();
                        completeTask(taskItem);
                    }
                }, 1000);
            }
            
            // 完成任务
            function completeTask(taskItem) {
                // 清除计时器
                if (globalTimerInterval) {
                    clearInterval(globalTimerInterval);
                    globalTimerInterval = null;
                }
                
                // 隐藏全屏倒计时
                hideCountdown();
                
                // 标记任务为完成
                taskItem.classList.add('completed');
                taskItem.classList.remove('active-task');
                
                // 更新按钮状态
                const startBtn = taskItem.querySelector('.btn-start, .btn-pause, .btn-resume, .btn.btn-start, .btn.btn-pause, .btn.btn-resume');
                if (startBtn) {
                    startBtn.innerHTML = '<i class="fas fa-play"></i> 重新开始';
                    startBtn.classList.remove('btn-pause', 'btn-resume');
                    startBtn.classList.add('btn-start');
                }
                
                // 更新完成按钮
                const completeBtn = taskItem.querySelector('.btn-complete');
                if (completeBtn) {
                    completeBtn.innerHTML = '<i class="fas fa-check-circle"></i> 已完成';
                    completeBtn.classList.add('completed');
                }
                
                // 保持当前剩余时间，不强制设置为0
                
                // 更新计时器显示
                updateTimerDisplay(taskItem, 0);
                
                // 重置活动任务
                if (taskItem === globalActiveTask) {
                    globalActiveTask = null;
                }
                
                // 获取当前日期和任务索引
                const todayStr = getTodayStr();
                const taskItems = Array.from(document.querySelectorAll('.timeline-item'));
                const taskIndex = taskItems.indexOf(taskItem);
                
                // 更新localStorage中的任务完成状态
                if (taskIndex !== -1) {
                    const tasks = JSON.parse(localStorage.getItem(getTaskStorageKey(todayStr)) || '[]');
                    tasks[taskIndex] = true;
                    localStorage.setItem(getTaskStorageKey(todayStr), JSON.stringify(tasks));
                }
                
                // 保存当前页面状态
                saveDayState(todayStr, taskItems);
                
                // 更新日历显示
                renderCalendar(new Date(todayStr));
                
                // 更新统计卡片显示科目时间分布
                setTimeout(() => {
                    updateStatCard(todayStr);
                }, 100);
            }
            
            // 更新计时器显示
            function updateTimerDisplay(taskItem, seconds) {
                const timerDisplay = taskItem.querySelector('.timer');
                if (!timerDisplay) {
                    console.error('未找到计时器显示元素');
                    return;
                }
                
                if (seconds <= 0) {
                    timerDisplay.textContent = '00:00';
                    timerDisplay.classList.remove('timer-running');
                    timerDisplay.classList.add('timer-completed');
                    return;
                }
                
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                timerDisplay.textContent = `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
                
                // 添加高亮动画
                if (taskItem === globalActiveTask) {
                    timerDisplay.classList.add('timer-running');
                } else {
                    timerDisplay.classList.remove('timer-running');
                }
            }

            // 统计区渲染函数，供计时/完成等操作实时调用
            function updateStatCard(dateStr) {
                const wrapper = document.getElementById('stat-card-wrapper');
                if (!wrapper) return;
                
                // 获取计划总学习时长
                let planTimeStr = '未设置';
                try {
                    const paramsStr = localStorage.getItem('custom_schedule_params');
                    if (paramsStr) {
                        const params = JSON.parse(paramsStr);
                        let totalMinutes = 0;
                        if (params.subjects && Array.isArray(params.subjects)) {
                            params.subjects.forEach(subject => {
                                const studyDuration = subject.studyDuration || 45;
                                const count = subject.count || 1;
                                totalMinutes += studyDuration * count;
                            });
                        }
                        const hours = Math.floor(totalMinutes / 60);
                        const minutes = totalMinutes % 60;
                        planTimeStr = (hours > 0 ? `${hours}小时` : '') + (minutes > 0 ? `${minutes}分钟` : '0分钟');
                    }
                } catch (e) {
                    planTimeStr = '未设置';
                }
                
                // 从localStorage获取指定日期的学习数据
                let totalSeconds = 0;
                let completedSubjectSeconds = {}; // 动态科目统计
                let subjectColors = {}; // 动态颜色映射
                
                // 获取指定日期的任务数据
                const taskStorageKey = getTaskStorageKey(dateStr);
                const savedTasks = JSON.parse(localStorage.getItem(taskStorageKey) || '[]');
                
                // 同时获取计时器数据
                const savedTimers = JSON.parse(localStorage.getItem(getTimerStorageKey(dateStr)) || '[]');
                
                // 统计指定日期的学习时长
                // 主要依赖当前页面的实时数据，因为savedTasks只存储完成状态
                if (savedTasks.length > 0) {
                    // 从模板中获取任务信息来计算时长
                    const templateTimeline = document.querySelector('#timeline-template .timeline');
                    const templateItems = templateTimeline ? Array.from(templateTimeline.querySelectorAll('.timeline-item')) : [];
                    
                    savedTasks.forEach((isCompleted, index) => {
                        if (isCompleted && templateItems[index]) {
                            const item = templateItems[index];
                            const duration = parseInt(item.dataset.duration) * 60; // 转换为秒
                            
                            let used = 0;
                            
                            // 只根据计时器数据计算已使用时长
                            if (savedTimers[index] !== undefined && savedTimers[index] !== null) {
                                const remain = parseInt(savedTimers[index]);
                                used = duration - remain;
                                if (used < 0) used = 0;
                            }
                            
                            totalSeconds += used;
                            
                            // 统计各科目时长
                            const subjectElement = item.querySelector('.subject');
                            if (subjectElement && used > 0) {
                                let subjectName = subjectElement.textContent.trim();
                                
                                // 如果是休息、用餐、复盘等特殊类型，使用特殊处理
                                if (subjectElement.classList.contains('rest') || subjectElement.classList.contains('meal')) {
                                    subjectName = '休息';
                                } else if (subjectElement.classList.contains('review')) {
                                    subjectName = '复盘';
                                }
                                
                                // 初始化科目统计
                                if (!completedSubjectSeconds[subjectName]) {
                                    completedSubjectSeconds[subjectName] = 0;
                                }
                                
                                completedSubjectSeconds[subjectName] += used;
                            }
                        }
                    });
                }
                
                // 如果是当天，同时检查当前页面的实时数据
                if (dateStr === getTodayStr()) {
                    const timeline = document.querySelector('#study-page-container .timeline');
                    const taskItems = timeline ? Array.from(timeline.querySelectorAll('.timeline-item')) : [];
                    
                    if (taskItems.length > 0) {
                        taskItems.forEach((item) => {
                            let duration = parseInt(item.dataset.duration) * 60;
                            let used = 0;
                            
                            // 只根据计时器数据计算已使用时长
                            if (item.dataset.remainingSeconds !== undefined) {
                                let remain = parseInt(item.dataset.remainingSeconds);
                                used = duration - remain;
                                if (used < 0) used = 0;
                            }
                            
                            totalSeconds += used;
                            
                            // 统计各科目时长
                            const subjectElement = item.querySelector('.subject');
                            if (subjectElement && used > 0) {
                                let subjectName = subjectElement.textContent.trim();
                                
                                // 如果是休息、用餐、复盘等特殊类型，使用特殊处理
                                if (subjectElement.classList.contains('rest') || subjectElement.classList.contains('meal')) {
                                    subjectName = '休息';
                                } else if (subjectElement.classList.contains('review')) {
                                    subjectName = '复盘';
                                }
                                
                                // 初始化科目统计
                                if (!completedSubjectSeconds[subjectName]) {
                                    completedSubjectSeconds[subjectName] = 0;
                                }
                                
                                completedSubjectSeconds[subjectName] += used;
                            }
                        });
                    }
                }
                
                // 预定义的颜色池，用于为不同科目分配颜色
                const colorPool = [
                    '#ff416c', '#2193b0', '#38ef7d', '#8e2de2', '#ffb199', 
                    '#fecfef', '#00c6ff', '#ff6b6b', '#4ecdc4', '#45b7d1',
                    '#96ceb4', '#feca57', '#ff9ff3', '#54a0ff', '#5f27cd'
                ];
                
                // 根据科目名称生成稳定的颜色索引
                function getSubjectColorIndex(subjectName) {
                    let hash = 0;
                    for (let i = 0; i < subjectName.length; i++) {
                        const char = subjectName.charCodeAt(i);
                        hash = ((hash << 5) - hash) + char;
                        hash = hash & hash; // 转换为32位整数
                    }
                    return Math.abs(hash) % colorPool.length;
                }
                
                // 为科目分配颜色
                Object.keys(completedSubjectSeconds).forEach(subjectName => {
                    if (!subjectColors[subjectName]) {
                        const colorIndex = getSubjectColorIndex(subjectName);
                        subjectColors[subjectName] = colorPool[colorIndex];
                    }
                });
                
                // 渲染统计卡片内容
                let hour = Math.floor(totalSeconds / 3600);
                let min = Math.floor((totalSeconds % 3600) / 60);
                let sec = totalSeconds % 60;
                let timeStr = (hour > 0 ? `${hour}小时` : '') + (min > 0 ? `${min}分` : (hour === 0 ? (sec > 0 ? '' : '0分') : '')) + (sec > 0 ? `${sec}秒` : (hour === 0 && min === 0 ? '0秒' : ''));
                
                // 确保重置后显示0秒
                if (totalSeconds === 0) {
                    timeStr = '0秒';
                }
                
                // 格式化日期显示
                const displayDate = dateStr === getTodayStr() ? '今日' : dateStr;
                
                let html = `<div class="stat-card">
                    <div class="stat-main-time"><i class='fas fa-hourglass-half' style='margin-right:10px;'></i>计划总学习时长：<span style='color:#26d0ce;'>${planTimeStr}</span></div>
                    <div class="stat-main-time"><i class='fas fa-hourglass-half' style='margin-right:10px;'></i>${displayDate}已学习：<span style='color:#26d0ce;'>${timeStr}</span></div>`;
                
                // 各科目时长分布
                let completedKeys = Object.keys(completedSubjectSeconds).filter(k => completedSubjectSeconds[k] > 0);
                if (completedKeys.length > 0) {
                    html += `<div class='stat-completed-list' style='margin-top:15px;'>`;
                    completedKeys.forEach(subjectName => {
                        let sec = completedSubjectSeconds[subjectName];
                        let h = Math.floor(sec / 3600);
                        let m = Math.floor((sec % 3600) / 60);
                        let s = sec % 60;
                        let str = (h > 0 ? `${h}小时` : '') + (m > 0 ? `${m}分` : (h === 0 ? (s > 0 ? '' : '0分') : '')) + (s > 0 ? `${s}秒` : (h === 0 && m === 0 ? '0秒' : ''));
                        html += `<div class='stat-completed-item'><span class='stat-completed-dot' style='background:${subjectColors[subjectName]};'></span>${subjectName}：<span style='color:#11998e;font-weight:bold;'>${str}</span></div>`;
                    });
                    html += `</div>`;
                }
                
                html += `</div>`;
                wrapper.innerHTML = html;
            }



            // 保存/恢复计时进度和完成状态到localStorage
            function saveDayState(dateStr, taskItems) {
                // 保存每个卡片的剩余秒数和完成状态
                const timers = [];
                const completed = [];
                taskItems.forEach(item => {
                    timers.push(item.dataset.remainingSeconds ? parseInt(item.dataset.remainingSeconds) : null);
                    completed.push(item.classList.contains('completed'));
                });
                localStorage.setItem(getTimerStorageKey(dateStr), JSON.stringify(timers));
                localStorage.setItem(getTaskStorageKey(dateStr), JSON.stringify(completed));
            }
            function restoreDayState(dateStr, taskItems) {
                // 恢复每个卡片的剩余秒数和完成状态
                const timers = JSON.parse(localStorage.getItem(getTimerStorageKey(dateStr)) || '[]');
                const completed = JSON.parse(localStorage.getItem(getTaskStorageKey(dateStr)) || '[]');
                taskItems.forEach((item, idx) => {
                    if (timers[idx] !== undefined && timers[idx] !== null) {
                        item.dataset.remainingSeconds = timers[idx];
                    } else {
                        item.removeAttribute('data-remaining-seconds');
                    }
                    if (completed[idx]) {
                        item.classList.add('completed');
                    } else {
                        item.classList.remove('completed');
                    }
                });
            }

            // 切换日期时自动恢复状态
            restoreDayState(currentViewDate, taskItems);

            // 切换日期时自动保存当前页面状态，再恢复目标日期状态
            let lastViewDate = getTodayStr();
            function switchDayAndRender(newDateStr, taskItems) {
                // 保存当前页面状态
                saveDayState(lastViewDate, taskItems);
                // 恢复目标日期状态
                restoreDayState(newDateStr, taskItems);
                lastViewDate = newDateStr;
            }

            // 新增：专门渲染计时统计区和重置按钮
            function renderStatCard(dateStr) {
                // 直接调用updateStatCard，保持逻辑一致
                updateStatCard(dateStr);
            }
            // renderStudyPage 只刷新study-page-container
            // 切换日期时：renderStatCard(currentViewDate); renderStudyPage(currentViewDate);

            // 1. 在JS中定时检查所有已设置提醒时间的任务，若到点则弹窗提醒
            setInterval(function() {
                // 只检查当前页面的.timeline-item
                const timeline = document.querySelector('#study-page-container .timeline');
                if (!timeline) return;
                const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                const now = new Date();
                items.forEach((item, idx) => {
                    const input = item.querySelector('.remind-time-input');
                    if (!input) return;
                    const remindTime = input.value;
                    if (!remindTime) return;
                    // 检查是否已提醒过
                    if (input.dataset.reminded === '1') return;
                    // 解析时间
                    const [h, m] = remindTime.split(':');
                    if (h === undefined || m === undefined) return;
                    const remindDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(h), parseInt(m), 0);
                    // 允许1分钟误差
                    if (now >= remindDate && now - remindDate < 60000) {
                        // 弹窗提醒
                        const title = item.querySelector('.activity-title')?.innerText || '任务提醒';
                        const detail = item.querySelector('.activity p')?.innerText || '';
                        alert(`任务提醒：${title}\n${detail}`);
                        input.dataset.reminded = '1';
                    }
                });
            }, 20000); // 每20秒检查一次

            // JS部分：初始化任务下拉框、设置提醒、定时检查
            let globalRemindList = [];
            function updateRemindTaskSelect() {
                const select = document.getElementById('remind-task-select');
                if (!select) return;
                select.innerHTML = '';
                // 获取当前页面所有任务
                const timeline = document.querySelector('#study-page-container .timeline');
                if (!timeline) return;
                const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                items.forEach((item, idx) => {
                    const title = item.querySelector('.activity-title')?.innerText || `任务${idx+1}`;
                    const option = document.createElement('option');
                    option.value = idx;
                    option.textContent = title;
                    select.appendChild(option);
                });
            }
            document.addEventListener('DOMContentLoaded', function() {
                setTimeout(updateRemindTaskSelect, 800); // 首次渲染后初始化
            });
            // 切换日期后也要刷新下拉框
            const origRenderStudyPage = renderStudyPage;
            renderStudyPage = function(dateStr) {
                origRenderStudyPage(dateStr);
                setTimeout(updateRemindTaskSelect, 200);
            };
            // 设置提醒按钮
            const remindBtn = document.getElementById('set-remind-btn');
            if (remindBtn) {
                remindBtn.onclick = function() {
                    const select = document.getElementById('remind-task-select');
                    const timeInput = document.getElementById('remind-time-input');
                    if (!select || !timeInput) return;
                    const idx = select.value;
                    const time = timeInput.value;
                    if (!time) { alert('请选择提醒时间'); return; }
                    // 获取任务信息
                    const timeline = document.querySelector('#study-page-container .timeline');
                    if (!timeline) return;
                    const items = Array.from(timeline.querySelectorAll('.timeline-item'));
                    const item = items[idx];
                    if (!item) return;
                    const title = item.querySelector('.activity-title')?.innerText || '任务提醒';
                    const detail = item.querySelector('.activity p')?.innerText || '';
                    globalRemindList.push({ idx: Number(idx), time, title, detail, reminded: false, date: getTodayStr() });
                    alert('提醒已设置！');
                };
            }
            // 定时检查提醒
            setInterval(function() {
                const now = new Date();
                globalRemindList.forEach(remind => {
                    if (remind.reminded) return;
                    if (remind.date !== getTodayStr()) return; // 只提醒今天
                    const [h, m] = remind.time.split(':');
                    if (h === undefined || m === undefined) return;
                    const remindDate = new Date(now.getFullYear(), now.getMonth(), now.getDate(), parseInt(h), parseInt(m), 0);
                    if (now >= remindDate && now - remindDate < 60000) {
                        alert(`任务提醒：${remind.title}\n${remind.detail}`);
                        remind.reminded = true;
                    }
                });
            }, 20000);

            // 确保始终插入返回按钮
            let studyPage = document.getElementById('study-page-container');
            if (studyPage && !document.getElementById('back-to-ai-form-btn')) {
                let backBtn = document.createElement('div');
                backBtn.id = 'back-to-ai-form-btn';
                backBtn.style = 'text-align:center;margin:20px 0;';
                backBtn.innerHTML = '<a href="index.html" style="color:#26d0ce;font-size:1.1rem;text-decoration:underline;">返回自定义设置</a>';
                studyPage.parentNode.insertBefore(backBtn, studyPage);
            }

            // ========== 编辑模式切换功能 ==========
            const editModeBtn = document.getElementById('edit-mode-btn');
            if (editModeBtn) {
                editModeBtn.addEventListener('click', function() {
                    // 限制编辑功能：只在当前日期允许编辑
                    if (currentViewDate !== getTodayStr()) {
                        alert('只能在当前日期编辑时间表');
                        return;
                    }
                    
                    editMode = !editMode;
                    toggleEditMode();
                });
            }
            
            function toggleEditMode() {
                const container = document.querySelector('#study-page-container');
                const btn = document.getElementById('edit-mode-btn');
                
                if (editMode) {
                    // 进入编辑模式
                    container.classList.add('edit-mode');
                    btn.innerHTML = '<i class="fas fa-save"></i> 保存时间表';
                    btn.style.background = '#4CAF50';
                    enableDragAndDrop();
                } else {
                    // 退出编辑模式
                    container.classList.remove('edit-mode');
                    btn.innerHTML = '<i class="fas fa-edit"></i> 编辑时间表';
                    btn.style.background = '#ff9800';
                    disableDragAndDrop();
                    saveCustomOrder();
                }
            }
            
            function enableDragAndDrop() {
                // 只在当前日期允许拖拽编辑
                if (currentViewDate !== getTodayStr()) {
                    return;
                }
                
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                timelineItems.forEach(item => {
                    // 跳过固定事件（用餐、复盘）
                    if (item.querySelector('.subject.meal') || item.querySelector('.subject.review')) {
                        item.classList.add('fixed');
                        return;
                    }
                    
                    item.draggable = true;
                    item.addEventListener('dragstart', handleDragStart);
                    item.addEventListener('dragend', handleDragEnd);
                });
                
                const timelineContainer = document.querySelector('#study-page-container .timeline-items');
                if (timelineContainer) {
                    timelineContainer.addEventListener('dragover', handleDragOver);
                    timelineContainer.addEventListener('drop', handleDrop);
                }
            }
            
            function disableDragAndDrop() {
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                timelineItems.forEach(item => {
                    item.draggable = false;
                    item.classList.remove('dragging', 'drag-over');
                    item.removeEventListener('dragstart', handleDragStart);
                    item.removeEventListener('dragend', handleDragEnd);
                });
                
                const timelineContainer = document.querySelector('#study-page-container .timeline-items');
                if (timelineContainer) {
                    timelineContainer.removeEventListener('dragover', handleDragOver);
                    timelineContainer.removeEventListener('drop', handleDrop);
                }
            }


            // ========== 拖拽事件处理 ==========
            function handleDragStart(e) {
                draggedElement = e.target;
                e.target.classList.add('dragging');
                e.dataTransfer.effectAllowed = 'move';
                e.dataTransfer.setData('text/html', e.target.outerHTML);
            }
            
            function handleDragEnd(e) {
                e.target.classList.remove('dragging');
                draggedElement = null;
            }
            
            function handleDragOver(e) {
                e.preventDefault();
                e.dataTransfer.dropEffect = 'move';
                
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                timelineItems.forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                const target = e.target.closest('.timeline-item');
                if (target && target !== draggedElement && !target.classList.contains('fixed')) {
                    target.classList.add('drag-over');
                }
            }
            
            function handleDrop(e) {
                e.preventDefault();
                
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                timelineItems.forEach(item => {
                    item.classList.remove('drag-over');
                });
                
                const target = e.target.closest('.timeline-item');
                if (target && draggedElement && target !== draggedElement && !target.classList.contains('fixed')) {
                    const container = target.parentNode;
                    const draggedIndex = Array.from(container.children).indexOf(draggedElement);
                    const targetIndex = Array.from(container.children).indexOf(target);
                    
                    if (draggedIndex < targetIndex) {
                        container.insertBefore(draggedElement, target.nextSibling);
                    } else {
                        container.insertBefore(draggedElement, target);
                    }
                    
                    // 重新计算时间
                    updateTimelineTimes();
                }
            }
            
            // ========== 时间自动调整逻辑 ==========
            function updateTimelineTimes() {
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                const startTime = getStartTimeFromParams();
                let current = startTime;
                
                timelineItems.forEach((item, index) => {
                    const duration = parseInt(item.dataset.duration);
                    
                    // 更新开始和结束时间
                    item.querySelector('.time').textContent = `${current} - ${addMinutes(current, duration)}`;
                    
                    // 更新下一个任务的开始时间
                    current = addMinutes(current, duration);
                });
            }
            
            function getStartTimeFromParams() {
                const paramsStr = localStorage.getItem('custom_schedule_params');
                if (paramsStr) {
                    const params = JSON.parse(paramsStr);
                    return params.startTime || '09:00';
                }
                return '09:00';
            }
            
            function addMinutes(time, mins) {
                const [h, m] = time.split(":").map(Number);
                let date = new Date(2000, 0, 1, h, m);
                date.setMinutes(date.getMinutes() + mins);
                return date.toTimeString().slice(0,5);
            }
            
            // ========== 本地存储保存功能 ==========
            function saveCustomOrder() {
                const timelineItems = document.querySelectorAll('#study-page-container .timeline-item');
                const customOrder = [];
                
                timelineItems.forEach(item => {
                    const subject = item.querySelector('.activity-title')?.textContent?.trim();
                    const time = item.querySelector('.time')?.textContent?.trim();
                    const duration = item.dataset.duration;
                    
                    if (subject && time) {
                        customOrder.push({
                            subject: subject,
                            time: time,
                            duration: duration,
                            type: item.querySelector('.subject')?.className?.includes('meal') ? 'meal' : 
                                  item.querySelector('.subject')?.className?.includes('review') ? 'review' : 'study'
                        });
                    }
                });
                
                localStorage.setItem('custom_timeline_order', JSON.stringify(customOrder));

            }
            
            function loadCustomOrder() {
                const customOrderStr = localStorage.getItem('custom_timeline_order');
                if (customOrderStr) {
                    try {
                        const customOrder = JSON.parse(customOrderStr);
        
                        return customOrder;
                    } catch (e) {
                        console.error('解析自定义顺序失败:', e);
                    }
                }
                return null;
            }

            // 生成协调的渐变色对
            function generateSubjectColors(count) {
                const colors = [];
                const hueStep = 360 / count;
                for (let i = 0; i < count; i++) {
                    const hue = (i * hueStep) % 360;
                    colors.push({
                        start: `hsl(${hue}, 70%, 50%)`,
                        end: `hsl(${(hue + 30) % 360}, 70%, 60%)`
                    });
                }
                return colors;
            }
            document.addEventListener('DOMContentLoaded', function() {
                // 只渲染用户自定义的时间表
                const paramsStr = localStorage.getItem('custom_schedule_params');
                const timelineEl = document.querySelector('#timeline-template .timeline-items');
                if (!paramsStr) {
                    if (timelineEl) timelineEl.innerHTML = '<div style="padding:32px;text-align:center;color:#888;">请先在设置页生成并保存时间表</div>';
                    renderStudyPage(currentViewDate); // 保证主区有提示
                    return;
                }
                let params;
                try {
                    params = JSON.parse(paramsStr);
                } catch (e) {
                    if (timelineEl) timelineEl.innerHTML = '<div style="padding:32px;text-align:center;color:#888;">时间表参数解析失败，请重新设置</div>';
                    renderStudyPage(currentViewDate);
                    return;
                }
                // 1. 先生成 timeline-items
                generateCustomSchedule(params);
                // 2. 再渲染主展示区
                renderStudyPage(currentViewDate);
            });
        });

        // 在 <script> 末尾添加：
        function generateCustomSchedule(params) {
            // 1. 解析参数
            const {
                startTime,
                lunchTime,
                lunchDuration,
                dinnerTime,
                dinnerDuration,
                reviewTime,
                reviewDuration,
                subjects
            } = params;
            // 默认时长设置
            const defaultStudyDuration = 45;
            const defaultBreakDuration = 10;
            
            // 2. 定义辅助函数
            function addMinutes(time, mins) {
                const [h, m] = time.split(":").map(Number);
                let date = new Date(2000, 0, 1, h, m);
                date.setMinutes(date.getMinutes() + mins);
                return date.toTimeString().slice(0,5);
            }
            
            function insertMeal(arr, time, duration, title, subjectClass) {
                // 查找插入点
                let idx = arr.findIndex(item=>item.start>=time);
                let meal = {
                    type: subjectClass,
                    start: time,
                    end: addMinutes(time, duration),
                    duration: duration,
                    subjectClass: subjectClass,
                    highlight: '',
                    title: title,
                    desc: subjectClass==='review'?'总结收获，规划明日重点':'营养均衡，完全脱离学习环境'
                };
                if(idx===-1) arr.push(meal);
                else arr.splice(idx,0,meal);
            }
            
            // 3. 生成时间线
            let timelineItems = [];
            
            // 1. 创建任务池，将每个科目的模块拆分为独立任务
            let taskPool = [];
            subjects.forEach((subj, subjIdx) => {
                const subjectStudyDuration = subj.studyDuration || defaultStudyDuration;
                const subjectBreakDuration = subj.breakDuration || defaultBreakDuration;
                const subjectType = getSubjectType(subj.name);
                
                for(let i=0; i<subj.count; i++) {
                    taskPool.push({
                        id: `${subjIdx}-${i}`,
                        subject: subj.name,
                        subjectType: subjectType,
                        subjectClass: getSubjectClass(subj.name),
                        duration: subjectStudyDuration,
                        breakDuration: subjectBreakDuration,
                        moduleIndex: i + 1,
                        isAfterLunch: false,
                        isEasySubject: subjectType === 'liberal' || subj.name.includes('英')
                    });
                }
            });
            
            // 2. 文理交叉算法
            let current = startTime;
            let lastSubject = null;
            let lastSubjectType = null;
            let consecutiveStudyTime = 0;
            
            // 健康休息机制：每45-60分钟学习后强制休息
            const maxConsecutiveStudyTime = 60;
            
            while (taskPool.length > 0) {
                // 选择下一个任务
                let selectedTask = null;
                let selectedIndex = -1;
                
                // 策略1：优先选择不同科目的任务
                for (let i = 0; i < taskPool.length; i++) {
                    const task = taskPool[i];
                    if (task.subject !== lastSubject) {
                        selectedTask = task;
                        selectedIndex = i;
                        break;
                    }
                }
                
                // 策略2：如果找不到不同科目，选择不同文理类型的任务
                if (!selectedTask) {
                    for (let i = 0; i < taskPool.length; i++) {
                        const task = taskPool[i];
                        if (task.subjectType !== lastSubjectType) {
                            selectedTask = task;
                            selectedIndex = i;
                            break;
                        }
                    }
                }
                
                // 策略3：如果还是找不到，选择第一个可用任务
                if (!selectedTask) {
                    selectedTask = taskPool[0];
                    selectedIndex = 0;
                }
                
                // 检查是否需要强制休息
                if (consecutiveStudyTime >= maxConsecutiveStudyTime) {
                    // 插入强制休息
                    timelineItems.push({
                        type: 'break',
                        subject: '强制休息',
                        start: current,
                        end: addMinutes(current, defaultBreakDuration),
                        duration: defaultBreakDuration,
                        subjectClass: 'rest',
                        highlight: '',
                        title: '健康休息',
                        desc: '连续学习时间过长，强制休息调整'
                    });
                    current = addMinutes(current, defaultBreakDuration);
                    consecutiveStudyTime = 0;
                }
                
                // 添加学习任务
                    timelineItems.push({
                        type: 'study',
                    subject: selectedTask.subject,
                        start: current,
                    end: addMinutes(current, selectedTask.duration),
                    duration: selectedTask.duration,
                    subjectClass: selectedTask.subjectClass,
                    highlight: selectedTask.subject.includes('英') ? 'english-highlight' : '',
                    title: selectedTask.subject + (selectedTask.moduleIndex > 1 ? `（第${selectedTask.moduleIndex}模块）` : ''),
                    desc: selectedTask.subject + "学习"
                });
                
                current = addMinutes(current, selectedTask.duration);
                consecutiveStudyTime += selectedTask.duration;
                
                // 更新状态
                lastSubject = selectedTask.subject;
                lastSubjectType = selectedTask.subjectType;
                
                // 移除已使用的任务
                taskPool.splice(selectedIndex, 1);
                
                // 添加科目间休息（除了最后一个任务）
                if (taskPool.length > 0) {
                        timelineItems.push({
                            type: 'break',
                        subject: '科目间休息',
                            start: current,
                        end: addMinutes(current, selectedTask.breakDuration),
                        duration: selectedTask.breakDuration,
                            subjectClass: 'rest',
                            highlight: '',
                            title: '短暂休息',
                        desc: '放松调整，准备下一科目'
                        });
                    current = addMinutes(current, selectedTask.breakDuration);
                    consecutiveStudyTime = 0;
                    }
                }
            // 插入午餐
            insertMeal(timelineItems, lunchTime, lunchDuration, '午餐与放松', 'meal');
            // 插入晚餐
            insertMeal(timelineItems, dinnerTime, dinnerDuration, '晚餐与放松', 'meal');
            // 插入复盘
            insertMeal(timelineItems, reviewTime, reviewDuration, '当日复盘与明日计划', 'review');
            
            // 午餐后优化：在午餐后安排轻松科目
            optimizeAfterLunch(timelineItems, lunchTime, lunchDuration);
            
            // 4. 渲染到页面
            console.log('timelineItems:', timelineItems); // <--- 加这一行
            const timelineEl = document.querySelector('#timeline-template .timeline-items');
            if (timelineEl) {
                timelineEl.innerHTML = timelineItems.sort((a,b)=>a.start.localeCompare(b.start)).map(item=>renderTimelineItem(item)).join('');

            }
            

        }
        function getSubjectClass(name) {
            if(name.includes('数')) return 'math';
            if(name.includes('英')) return 'english';
            if(name.includes('专')) return 'major';
            if(name.includes('政')) return 'politics';
            return 'major';
        }
        
        // 科目分类函数：判断文理科
        function getSubjectType(name) {
            const liberalArts = ['英语', '政治', '语文', '历史', '地理', '文学', '语言', '阅读', '写作'];
            const science = ['数学', '物理', '化学', '生物', '专业课', '工程', '技术', '编程', '算法'];
            
            // 检查是否包含文科关键词
            for (let keyword of liberalArts) {
                if (name.includes(keyword)) {
                    return 'liberal'; // 文科
                }
            }
            
            // 检查是否包含理科关键词
            for (let keyword of science) {
                if (name.includes(keyword)) {
                    return 'science'; // 理科
                }
            }
            
            // 默认视为理科
            return 'science';
        }
        
        // 午餐后优化函数
        function optimizeAfterLunch(timelineItems, lunchTime, lunchDuration) {
            function addMinutes(time, mins) {
                const [h, m] = time.split(":").map(Number);
                let date = new Date(2000, 0, 1, h, m);
                date.setMinutes(date.getMinutes() + mins);
                return date.toTimeString().slice(0,5);
            }
            
            const lunchEnd = addMinutes(lunchTime, lunchDuration);
            
            // 找到午餐后的第一个学习任务
            for (let i = 0; i < timelineItems.length; i++) {
                const item = timelineItems[i];
                if (item.type === 'study' && item.start >= lunchEnd) {
                    // 检查是否是轻松科目，如果不是，尝试与后面的轻松科目交换
                    if (!item.subject.includes('英') && !item.subject.includes('政治')) {
                        // 寻找后面的轻松科目
                        for (let j = i + 1; j < timelineItems.length; j++) {
                            const laterItem = timelineItems[j];
                            if (laterItem.type === 'study' && 
                                (laterItem.subject.includes('英') || laterItem.subject.includes('政治'))) {
                                // 交换时间
                                const tempStart = item.start;
                                const tempEnd = item.end;
                                item.start = laterItem.start;
                                item.end = laterItem.end;
                                laterItem.start = tempStart;
                                laterItem.end = tempEnd;
                                break;
                            }
                        }
                    }
                    break;
                }
            }
        }
        
        function renderTimelineItem(item) {
            let icon = item.type==='break'?'<i class="fas fa-coffee"></i>':'';
            let tomato = item.type==='study'?'<span class="tomato"></span>':'';
            let highlight = item.highlight?` ${item.highlight}`:'';
            let subjectLabel = item.type==='break'?'<div class="subject rest">休息</div>':
                item.type==='meal'?'<div class="subject meal">休息</div>':
                item.type==='review'?'<div class="subject review">复盘</div>':
                `<div class="subject ${item.subjectClass}">${item.subject||''}</div>`;
            let btnLabel = item.type==='review'?'复盘':item.type==='break'?'休息':'学习';
            return `<div class="timeline-item${highlight}" data-duration="${item.duration}">
                <div class="time">${item.start} - ${item.end}</div>
                <div class="activity">
                    <div class="activity-title">${item.title} ${tomato} <span class="duration">${item.duration}分钟</span></div>
                    <div class="subject-label">${subjectLabel}</div>
                    <p class="task-description">${item.desc}</p>
                </div>
                <div class="task-controls">
                    <button class="btn btn-start"><i class="fas fa-play"></i> 开始${btnLabel}</button>
                    <button class="btn btn-complete"><i class="fas fa-check"></i> 完成${btnLabel}</button>
                </div>
                <div class="timer"></div>
            </div>`;
        }
        
        // 励志语录自动保存功能
        function initMottoEditor() {
            // 加载保存的励志语录
            loadSavedMottos();
            
            // 为可编辑元素添加事件监听
            document.querySelectorAll('.motto-quote, .motto-author').forEach(element => {
                // 焦点事件
                element.addEventListener('focus', function() {
                    this.style.backgroundColor = 'rgba(38, 208, 206, 0.1)';
                });
                
                // 失焦事件 - 自动保存
                element.addEventListener('blur', function() {
                    this.style.backgroundColor = '';
                    // 延迟保存，避免频繁保存
                    setTimeout(() => {
                        saveMottos();
                    }, 100);
                });
                
                // 输入事件 - 实时保存
                element.addEventListener('input', function() {
                    // 使用防抖，避免频繁保存
                    clearTimeout(this.saveTimeout);
                    this.saveTimeout = setTimeout(() => {
                        saveMottos();
                    }, 500);
                });
            });
        }
        
        function saveMottos() {
            const mottos = [];
            
            // 收集所有励志语录
            document.querySelectorAll('.motto-quote').forEach((quote, index) => {
                const author = document.querySelector(`[data-author-id="${index + 1}"]`);
                mottos.push({
                    quote: quote.textContent.trim(),
                    author: author ? author.textContent.trim() : ''
                });
            });
            
            // 保存到localStorage
            localStorage.setItem('custom_mottos', JSON.stringify(mottos));
        }
        
        function loadSavedMottos() {
            const saved = localStorage.getItem('custom_mottos');
            if (!saved) return;
            
            try {
                const mottos = JSON.parse(saved);
                mottos.forEach((motto, index) => {
                    const quoteElement = document.querySelector(`[data-motto-id="${index + 1}"]`);
                    const authorElement = document.querySelector(`[data-author-id="${index + 1}"]`);
                    
                    if (quoteElement && motto.quote) {
                        quoteElement.textContent = motto.quote;
                    }
                    if (authorElement && motto.author) {
                        authorElement.textContent = motto.author;
                    }
                });
            } catch (e) {

            }
        }
        

    </script>
</body>
</html>